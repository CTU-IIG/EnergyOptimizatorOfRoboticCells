<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>solver: /home/bukatlib/Downloads/Solver/src/HeuristicSolver/HeuristicAlgorithms.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">solver
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_93efc9365a6be47fd18940a722debe85.html">HeuristicSolver</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">HeuristicAlgorithms.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">        This file is part of the EnergyOptimizatorOfRoboticCells program.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">        EnergyOptimizatorOfRoboticCells is free software: you can redistribute it and/or modify</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">        it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">        the Free Software Foundation, either version 3 of the License, or</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">        (at your option) any later version.</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">        EnergyOptimizatorOfRoboticCells is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">        but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">        GNU General Public License for more details.</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">        You should have received a copy of the GNU General Public License</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">        along with EnergyOptimizatorOfRoboticCells. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;chrono&gt;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Algorithms_8h.html">Shared/Algorithms.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="HeuristicAlgorithms_8h.html">HeuristicSolver/HeuristicAlgorithms.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="SolutionChecker_8h.html">Solution/SolutionChecker.h</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacestd.html">std</a>;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacestd_1_1chrono.html">std::chrono</a>;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">static</span> random_device rd;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div>
<div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="classUnimodalFunctionHeuristic.html">   36</a></span>&#160;<span class="keyword">class </span><a class="code" href="classUnimodalFunctionHeuristic.html">UnimodalFunctionHeuristic</a> {</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        <span class="keyword">public</span>:</div>
<div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="classUnimodalFunctionHeuristic.html#a7371d3a7381ee883a488603d02beef9b">   43</a></span>&#160;                <a class="code" href="classUnimodalFunctionHeuristic.html#a7371d3a7381ee883a488603d02beef9b">UnimodalFunctionHeuristic</a>(<a class="code" href="classMovement.html">Movement</a> *mv1, <a class="code" href="classMovement.html">Movement</a> *mv2, <span class="keywordtype">double</span> duration) : mMv1(mv1), mMv2(mv2), mTotalDuration(duration) {</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;                        <span class="keywordflow">if</span> (mv1 == <span class="keyword">nullptr</span> || mv2 == <span class="keyword">nullptr</span> || duration &lt; 0.0)</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;                                <span class="keywordflow">throw</span> <a class="code" href="classInvalidArgument.html">InvalidArgument</a>(caller(), <span class="stringliteral">&quot;Attempt to pass the malicious constructor parameters!&quot;</span>);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mv1-&gt;minDuration()+mv2-&gt;minDuration() &gt;= duration+2*<a class="code" href="NumericConstants_8h.html#aeff822503333aed003c2ce1c6673295b">TIME_ERR</a> || mv1-&gt;maxDuration()+mv2-&gt;maxDuration()+2*<a class="code" href="NumericConstants_8h.html#aeff822503333aed003c2ce1c6673295b">TIME_ERR</a> &lt;= duration)</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                                <span class="keywordflow">throw</span> <a class="code" href="classInvalidArgument.html">InvalidArgument</a>(caller(), <span class="stringliteral">&quot;Invalid constructor parameters, the solution is infeasible!&quot;</span>);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                        mFromX = max(duration-mv2-&gt;maxDuration(), mv1-&gt;minDuration());</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;                        mToX = min(duration-mv2-&gt;minDuration(), mv1-&gt;maxDuration());</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                        mDirection = mToX-mFromX;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                        assert(mDirection &gt; -<a class="code" href="NumericConstants_8h.html#aeff822503333aed003c2ce1c6673295b">TIME_ERR</a> &amp;&amp; <span class="stringliteral">&quot;A bug in the UnimodalFunctionHeuristic class, it should be positive!&quot;</span>);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                }</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="classUnimodalFunctionHeuristic.html#a2fa480addf2afe3a54cfd302f262bdb1">   60</a></span>&#160;                <span class="keywordtype">double</span> <a class="code" href="classUnimodalFunctionHeuristic.html#a2fa480addf2afe3a54cfd302f262bdb1">tolerance</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                        <span class="keywordflow">if</span> (mDirection &gt;= <a class="code" href="NumericConstants_8h.html#a3ebebeda85a70b80e3aaa937ed8fb7a3">TIME_TOL</a>)</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                                <span class="keywordflow">return</span> <a class="code" href="NumericConstants_8h.html#a3ebebeda85a70b80e3aaa937ed8fb7a3">TIME_TOL</a>/mDirection;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                                <span class="keywordflow">return</span> 1.0;     <span class="comment">// solution is fixed, nothing to be optimized</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                }</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div>
<div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="classUnimodalFunctionHeuristic.html#a14bfec242b90d2ff37a5b85fc0d07be8">   71</a></span>&#160;                pair&lt;double, double&gt; <a class="code" href="classUnimodalFunctionHeuristic.html#a14bfec242b90d2ff37a5b85fc0d07be8">durations</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; alpha)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                        <span class="keywordflow">if</span> (alpha &lt; 0.0 || alpha &gt; 1.0)</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                                <span class="keywordflow">throw</span> <a class="code" href="classInvalidArgument.html">InvalidArgument</a>(caller(), <span class="stringliteral">&quot;Invalid function parameter, it must be in a range from 0.0 to 1.0!&quot;</span>);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                        <span class="keywordtype">double</span> d1 = mFromX+alpha*mDirection, d2 = mTotalDuration-d1;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                        assert(abs(d1+d2-mTotalDuration) &lt; 5*<a class="code" href="NumericConstants_8h.html#aeff822503333aed003c2ce1c6673295b">TIME_ERR</a> &amp;&amp; <span class="stringliteral">&quot;Invalid golden search of the method, solution infeasible!&quot;</span>);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                        assert(mMv1-&gt;minDuration() &lt; d1+5*<a class="code" href="NumericConstants_8h.html#aeff822503333aed003c2ce1c6673295b">TIME_ERR</a> &amp;&amp; d1 &lt; mMv1-&gt;maxDuration()+5*<a class="code" href="NumericConstants_8h.html#aeff822503333aed003c2ce1c6673295b">TIME_ERR</a> &amp;&amp; <span class="stringliteral">&quot;Duration of movement 1 is out of bound!&quot;</span>);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                        assert(mMv2-&gt;minDuration() &lt; d2+5*<a class="code" href="NumericConstants_8h.html#aeff822503333aed003c2ce1c6673295b">TIME_ERR</a> &amp;&amp; d2 &lt; mMv2-&gt;maxDuration()+5*<a class="code" href="NumericConstants_8h.html#aeff822503333aed003c2ce1c6673295b">TIME_ERR</a> &amp;&amp; <span class="stringliteral">&quot;Duration of movement 2 is out of bound!&quot;</span>);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                        <span class="keywordflow">return</span> { d1, d2 };</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                }</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="classUnimodalFunctionHeuristic.html#a94c1eaf7f8c66a5407469254eba7376a">   87</a></span>&#160;                <span class="keywordtype">double</span> <a class="code" href="classUnimodalFunctionHeuristic.html#a94c1eaf7f8c66a5407469254eba7376a">functionValue</a>(<span class="keyword">const</span> <span class="keywordtype">double</span>&amp; alpha)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; durPair = durations(alpha);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                        <span class="keywordflow">return</span> mMv1-&gt;energyConsumption(durPair.first)+mMv2-&gt;energyConsumption(durPair.second);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                }</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <span class="keyword">private</span>:</div>
<div class="line"><a name="l00094"></a><span class="lineno"><a class="line" href="classUnimodalFunctionHeuristic.html#a96d5698b4bf2ea174754568f1cd202a8">   94</a></span>&#160;                <span class="keywordtype">double</span> <a class="code" href="classUnimodalFunctionHeuristic.html#a96d5698b4bf2ea174754568f1cd202a8">mDirection</a>;</div>
<div class="line"><a name="l00096"></a><span class="lineno"><a class="line" href="classUnimodalFunctionHeuristic.html#ae4bd38470fb5aba06df52d451d4934c9">   96</a></span>&#160;                <span class="keywordtype">double</span> <a class="code" href="classUnimodalFunctionHeuristic.html#ae4bd38470fb5aba06df52d451d4934c9">mFromX</a>;</div>
<div class="line"><a name="l00098"></a><span class="lineno"><a class="line" href="classUnimodalFunctionHeuristic.html#ac0e1926785333ec3b798e70296a4964f">   98</a></span>&#160;                <span class="keywordtype">double</span> <a class="code" href="classUnimodalFunctionHeuristic.html#ac0e1926785333ec3b798e70296a4964f">mToX</a>;</div>
<div class="line"><a name="l00100"></a><span class="lineno"><a class="line" href="classUnimodalFunctionHeuristic.html#abf424b8eae6b66ff39f868dd1fb576f3">  100</a></span>&#160;                <a class="code" href="classMovement.html">Movement</a> *<a class="code" href="classUnimodalFunctionHeuristic.html#abf424b8eae6b66ff39f868dd1fb576f3">mMv1</a>;</div>
<div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="classUnimodalFunctionHeuristic.html#af0232f67ffe0a68c9a85feb900b8de52">  102</a></span>&#160;                <a class="code" href="classMovement.html">Movement</a> *<a class="code" href="classUnimodalFunctionHeuristic.html#af0232f67ffe0a68c9a85feb900b8de52">mMv2</a>;</div>
<div class="line"><a name="l00104"></a><span class="lineno"><a class="line" href="classUnimodalFunctionHeuristic.html#a52a4add6f8ff2d18484e4249e179278b">  104</a></span>&#160;                <span class="keywordtype">double</span> <a class="code" href="classUnimodalFunctionHeuristic.html#a52a4add6f8ff2d18484e4249e179278b">mTotalDuration</a>;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;};</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div>
<div class="line"><a name="l00107"></a><span class="lineno"><a class="line" href="classHeuristicAlgorithms.html#aa36d3769a748d8c3ded630c515e0e8ad">  107</a></span>&#160;vector&lt;vector&lt;Location*&gt;&gt; <a class="code" href="classHeuristicAlgorithms.html#aa36d3769a748d8c3ded630c515e0e8ad">HeuristicAlgorithms::initializePartialSolution</a>(<a class="code" href="structPartialSolution.html">PartialSolution</a>&amp; ps)<span class="keyword"> const     </span>{</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <span class="keyword">const</span> vector&lt;Robot*&gt;&amp; robots = mLine.robots();</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        uint32_t numberOfRobots = robots.size();</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="keywordflow">if</span> (ps.<a class="code" href="structPartialSolution.html#a50fb6d7e10ac824afeeb56724d8c7468">locs</a>.size() != numberOfRobots)</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                <span class="keywordflow">throw</span> <a class="code" href="classInvalidArgument.html">InvalidArgument</a>(caller(), <span class="stringliteral">&quot;Invalid initial partial solution!&quot;</span>);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        ps.<a class="code" href="structPartialSolution.html#a4bc15548f2b4e6ae425952245ba3cca8">mvs</a>.clear();</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="keywordtype">bool</span> writePwrms = ps.<a class="code" href="structPartialSolution.html#a011d753a484c4fa2e0bf803a49204ea6">pwrms</a>.empty();</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        vector&lt;vector&lt;Location*&gt;&gt; fixed(numberOfRobots);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <span class="keywordflow">for</span> (uint32_t r = 0; r &lt; numberOfRobots; ++r)   {</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                vector&lt;Movement*&gt; mvs;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                <span class="keyword">const</span> vector&lt;Location*&gt;&amp; locs = ps.<a class="code" href="structPartialSolution.html#a50fb6d7e10ac824afeeb56724d8c7468">locs</a>[r];</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                assert(locs.size() &gt; 1 &amp;&amp; <span class="stringliteral">&quot;Circuits in the partial solution should be filled in!&quot;</span>);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                <span class="keywordflow">for</span> (uint32_t l = 0; l+1 &lt; locs.size(); ++l)    {</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                        <a class="code" href="classLocation.html">Location</a> *from = locs[l], *to = locs[l+1];</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                        <a class="code" href="classMovement.html">Movement</a> *mv = getValue(mMapping.locationsToMovement, {from, to}, caller());</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                        assert(mv != <span class="keyword">nullptr</span> &amp;&amp; <span class="stringliteral">&quot;Unexpected nullptr! Should be checked by setValue previously!&quot;</span>);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                        mvs.push_back(mv);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                        <span class="comment">// Check whether the location must be fixed...</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                        <span class="keywordflow">if</span> (mMapping.sptComp.count(from-&gt;parent()) &gt; 0)</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                                fixed[r].push_back(from);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                }</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                ps.<a class="code" href="structPartialSolution.html#a4bc15548f2b4e6ae425952245ba3cca8">mvs</a>.push_back(move(mvs));</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                <span class="keywordflow">if</span> (writePwrms == <span class="keyword">true</span>)</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                        ps.<a class="code" href="structPartialSolution.html#a011d753a484c4fa2e0bf803a49204ea6">pwrms</a>.emplace_back(locs.size(), robots[r]-&gt;fastestPowerSavingMode());</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        }</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <span class="keywordflow">return</span> fixed;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;}</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div>
<div class="line"><a name="l00138"></a><span class="lineno"><a class="line" href="classHeuristicAlgorithms.html#abd5588eab6e5aaf559d00d8421a51009">  138</a></span>&#160;<a class="code" href="structOptimalTiming.html">OptimalTiming</a> <a class="code" href="classHeuristicAlgorithms.html#abd5588eab6e5aaf559d00d8421a51009">HeuristicAlgorithms::solvePartialProblem</a>(<span class="keyword">const</span> <a class="code" href="structPartialSolution.html">PartialSolution</a>&amp; ps, <span class="keyword">const</span> <a class="code" href="structCircuitTuple.html">CircuitTuple</a>&amp; t, <a class="code" href="DataStructures_8h.html#a37b7af86392f48cd5663232e21b14b09">Algo</a> algo) {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <a class="code" href="structSolution.html">Solution</a> s;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <a class="code" href="structOptimalTiming.html">OptimalTiming</a> ot;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="keywordtype">bool</span> collisionsFeasible = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        high_resolution_clock::time_point startInit = high_resolution_clock::now();</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <a class="code" href="classRoboticLineSolverLP.html">RoboticLineSolverLP</a> solver(mLine, ps, mMapping);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="keywordtype">double</span> extraTime = duration_cast&lt;duration&lt;double&gt;&gt;(high_resolution_clock::now()-startInit).count();</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="keywordtype">double</span> minCriterion = F64_MAX, maxCriterion = F64_MIN;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        mKB.recordPartialProblemSolveCall();</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="keywordflow">while</span> (!collisionsFeasible)     {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                high_resolution_clock::time_point startLP = high_resolution_clock::now();</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                s = solver.<a class="code" href="classRoboticLineSolverLP.html#aa2d9352113dd4da6a46ef216feb15796">solve</a>();</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                mKB.recordLPCall(duration_cast&lt;duration&lt;double&gt;&gt;(high_resolution_clock::now()-startLP).count()+extraTime);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                <span class="keywordflow">if</span> (s.<a class="code" href="structSolution.html#a21c7486cdfe34ac5f7769b3053f10a71">status</a> == OPTIMAL)        {</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                        ot = <a class="code" href="Solution_8h.html#a1eea77bd3ba8037d1d799c786438b53d">convert</a>(ps, s);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                        minCriterion = min(minCriterion, ot.<a class="code" href="structOptimalTiming.html#a2c697a59113a6120436a02dda26af22a">totalEnergy</a>);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                        maxCriterion = max(maxCriterion, ot.<a class="code" href="structOptimalTiming.html#a2c697a59113a6120436a02dda26af22a">totalEnergy</a>);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                        <span class="keyword">const</span> <a class="code" href="structCollisionResolution.html">CollisionResolution</a>&amp; r = resolveTheWorstCollision(ps, ot, s);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                        <span class="keywordflow">if</span> (r.<a class="code" href="structCollisionResolution.html#a839f4a62c78c4722f7e9e89ddadffa15">a1</a> != <span class="keyword">nullptr</span> &amp;&amp; r.<a class="code" href="structCollisionResolution.html#a36aa751bee854b7c4867b3da5039599b">a2</a> != <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                                solver.<a class="code" href="classRoboticLineSolverLP.html#a03e4ded7195b4bef933e3bbafb2e56ee">addCollisionResolution</a>(r.<a class="code" href="structCollisionResolution.html#a839f4a62c78c4722f7e9e89ddadffa15">a1</a>, r.<a class="code" href="structCollisionResolution.html#a36aa751bee854b7c4867b3da5039599b">a2</a>, r.<a class="code" href="structCollisionResolution.html#a2034dddc5d0801cf0b6376f2f0f8aa30">multiplier</a>);</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                                collisionsFeasible = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                        extraTime = 0.0;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                        <span class="keywordflow">switch</span> (algo) {</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                                <span class="keywordflow">case</span> LP_INITIAL_PROBLEM:</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                                        mKB.reportInfDueToLP();</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                                <span class="keywordflow">case</span> POWER_MODE_HEURISTIC:</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                                        mKB.reportInfDueToPwrmHeur();</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                                <span class="keywordflow">case</span> LOCATION_CHANGE_HEURISTIC:</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                                        mKB.reportInfDueToLocHeur();</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                                <span class="keywordflow">case</span> PATH_CHANGE:</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                                        mKB.reportInfDueToPathChange();</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                        }</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                        mKB.recordInfeasibleLP();</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                        <span class="keywordflow">throw</span> <a class="code" href="classNoFeasibleSolutionExists.html">NoFeasibleSolutionExists</a>(caller(), <span class="stringliteral">&quot;Cannot solve the subproblem to optimality!&quot;</span>);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                }</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        }</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="preprocessor">        #ifndef NDEBUG</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <a class="code" href="classSolutionChecker.html">SolutionChecker</a> checker(mLine, mMapping, s);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="keywordflow">if</span> (!checker.<a class="code" href="classSolutionChecker.html#a6a2add64cd9fb9c04e9c922df1079663">checkAll</a>())</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                <span class="keywordflow">throw</span> <a class="code" href="classSolverException.html">SolverException</a>(caller(), <span class="stringliteral">&quot;A bug in solving the partial LP problem, the solution is infeasible!&quot;</span>);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="preprocessor">        #endif</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        mKB.candidate(s, t);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <span class="keywordflow">if</span> (minCriterion &gt; 0.0)</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                mKB.recordLPFixDeterioration(maxCriterion/minCriterion-1.0);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <span class="keywordflow">return</span> ot;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;}</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div>
<div class="line"><a name="l00199"></a><span class="lineno"><a class="line" href="classHeuristicAlgorithms.html#a06c6dc074edf564b38dd85ea99148180">  199</a></span>&#160;<a class="code" href="structOptimalTiming.html">OptimalTiming</a> <a class="code" href="classHeuristicAlgorithms.html#a06c6dc074edf564b38dd85ea99148180">HeuristicAlgorithms::convert</a>(<span class="keyword">const</span> <a class="code" href="structPartialSolution.html">PartialSolution</a>&amp; ps, <span class="keyword">const</span> <a class="code" href="structSolution.html">Solution</a>&amp; s)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        <a class="code" href="structOptimalTiming.html">OptimalTiming</a> timing;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        timing.<a class="code" href="structOptimalTiming.html#a2c697a59113a6120436a02dda26af22a">totalEnergy</a> = s.<a class="code" href="structSolution.html#af8d9eff375b22d79d5a05ee49908dce6">totalEnergy</a>;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        vector&lt;double&gt; startTimes, durations;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        uint32_t numberOfRobots = mLine.robots().size();</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="keywordflow">for</span> (uint32_t r = 0; r &lt; numberOfRobots; ++r)   {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                <span class="keyword">const</span> vector&lt;Location*&gt;&amp; locs = ps.<a class="code" href="structPartialSolution.html#a50fb6d7e10ac824afeeb56724d8c7468">locs</a>[r];</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                <span class="keywordflow">for</span> (<a class="code" href="classLocation.html">Location</a> *loc : locs)      {</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                        assert(loc != <span class="keyword">nullptr</span> &amp;&amp; loc-&gt;parent() != <span class="keyword">nullptr</span> &amp;&amp; <span class="stringliteral">&quot;Unexpected null pointer!&quot;</span>);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                        pair&lt;double, double&gt; val;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; sit = s.<a class="code" href="structSolution.html#af866c54d9f8d981893e55b572aed0375">startTimeAndDuration</a>.find(loc-&gt;parent()-&gt;aid());</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                        <span class="keywordflow">if</span> (sit != s.<a class="code" href="structSolution.html#af866c54d9f8d981893e55b572aed0375">startTimeAndDuration</a>.cend())</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                                val = sit-&gt;second;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                                <span class="keywordflow">throw</span> <a class="code" href="classSolverException.html">SolverException</a>(caller(), <span class="stringliteral">&quot;Given the incomplete solution!&quot;</span>);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                        startTimes.push_back(val.first);</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                        durations.push_back(val.second);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                        timing.<a class="code" href="structOptimalTiming.html#a56957ffcae1b9fbe374243eae121834b">actToStartAndDur</a>[loc-&gt;parent()] = val;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                        timing.<a class="code" href="structOptimalTiming.html#a7484e949e2071d1e150aaade60768365">modeToStartAndDur</a>[loc] = val;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                }</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                timing.<a class="code" href="structOptimalTiming.html#a8d8fa55e34745670850977414adbdd6c">startLocs</a>.push_back(move(startTimes));</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                timing.<a class="code" href="structOptimalTiming.html#a1eaccbd58b39bfd0c4060269d7254407">durLocs</a>.push_back(move(durations));</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                startTimes.clear(); durations.clear();</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                <span class="keyword">const</span> vector&lt;Movement*&gt;&amp; mvs = ps.<a class="code" href="structPartialSolution.html#a4bc15548f2b4e6ae425952245ba3cca8">mvs</a>[r];</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                <span class="keywordflow">for</span> (<a class="code" href="classMovement.html">Movement</a> *mv : mvs)        {</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                        assert(mv != <span class="keyword">nullptr</span> &amp;&amp; mv-&gt;parent() != <span class="keyword">nullptr</span> &amp;&amp; <span class="stringliteral">&quot;Unexpected null pointer!&quot;</span>);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                        pair&lt;double, double&gt; val;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; sit = s.<a class="code" href="structSolution.html#af866c54d9f8d981893e55b572aed0375">startTimeAndDuration</a>.find(mv-&gt;parent()-&gt;aid());</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                        <span class="keywordflow">if</span> (sit != s.<a class="code" href="structSolution.html#af866c54d9f8d981893e55b572aed0375">startTimeAndDuration</a>.cend())</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                                val = sit-&gt;second;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                                <span class="keywordflow">throw</span> <a class="code" href="classSolverException.html">SolverException</a>(caller(), <span class="stringliteral">&quot;Given the incomplete solution!&quot;</span>);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                        startTimes.push_back(val.first);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                        durations.push_back(val.second);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                        timing.<a class="code" href="structOptimalTiming.html#a56957ffcae1b9fbe374243eae121834b">actToStartAndDur</a>[mv-&gt;parent()] = val;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                        timing.<a class="code" href="structOptimalTiming.html#a7484e949e2071d1e150aaade60768365">modeToStartAndDur</a>[mv] = val;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                timing.<a class="code" href="structOptimalTiming.html#a0723b96a68af48e083145b22f6102cf1">startMvs</a>.push_back(move(startTimes));</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                timing.<a class="code" href="structOptimalTiming.html#a826c23e5865dcc4291085d06cfc9bd34">durMvs</a>.push_back(move(durations));</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                startTimes.clear(); durations.clear();</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        }</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <span class="keywordflow">return</span> timing;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;}</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div>
<div class="line"><a name="l00251"></a><span class="lineno"><a class="line" href="classHeuristicAlgorithms.html#a3c7f241e3a995dec4df37f941776cdd1">  251</a></span>&#160;<a class="code" href="structCollisionResolution.html">CollisionResolution</a> <a class="code" href="classHeuristicAlgorithms.html#a3c7f241e3a995dec4df37f941776cdd1">HeuristicAlgorithms::resolveCollision</a>(<a class="code" href="classActivityMode.html">ActivityMode</a>* m1, <span class="keywordtype">double</span> s1, <span class="keywordtype">double</span> d1, <a class="code" href="classActivityMode.html">ActivityMode</a>* m2, <span class="keywordtype">double</span> s2, <span class="keywordtype">double</span> d2)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <a class="code" href="structCollisionResolution.html">CollisionResolution</a> cl;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <span class="keywordtype">double</span> cycleTime = mLine.productionCycleTime();</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        <span class="keywordtype">double</span> s1m = fmod(s1, cycleTime), s2m = fmod(s2, cycleTime);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="keywordflow">if</span> (s1m &gt; s2m)  {</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                swap(m1, m2); swap(s1, s2); swap(d1, d2); swap(s1m, s2m);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        }</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="keywordtype">double</span> intersection1 = min(max(s1m+d1-s2m, 0.0), d2);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="keywordtype">double</span> intersection2 = min(max(s2m+d2-(s1m+cycleTime), 0.0), d1);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        cl.<a class="code" href="structCollisionResolution.html#a4e89d61d52db1501a516f6879276de3f">intersection</a> = intersection1 + intersection2;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <span class="comment">// Remark: Since d1 + d2 &lt;= CT, not both intersections are possible at once.</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="keywordflow">if</span> (cl.<a class="code" href="structCollisionResolution.html#a4e89d61d52db1501a516f6879276de3f">intersection</a> &gt; <a class="code" href="NumericConstants_8h.html#a3ebebeda85a70b80e3aaa937ed8fb7a3">TIME_TOL</a> || !(s2m+d2-s1m &lt;= cycleTime+<a class="code" href="NumericConstants_8h.html#a3ebebeda85a70b80e3aaa937ed8fb7a3">TIME_TOL</a> &amp;&amp; s1m+d1 &lt;= s2m+<a class="code" href="NumericConstants_8h.html#a3ebebeda85a70b80e3aaa937ed8fb7a3">TIME_TOL</a>))        {</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                <span class="keywordflow">if</span> (intersection2 &gt; <a class="code" href="NumericConstants_8h.html#a3ebebeda85a70b80e3aaa937ed8fb7a3">TIME_TOL</a>)</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                        s1m += cycleTime;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                <span class="keywordflow">if</span> (s1m+0.5*d1 &lt;= s2m+0.5*d2)   {</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                        cl.<a class="code" href="structCollisionResolution.html#a839f4a62c78c4722f7e9e89ddadffa15">a1</a> = m1-&gt;baseParent();</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                        cl.<a class="code" href="structCollisionResolution.html#a36aa751bee854b7c4867b3da5039599b">a2</a> = m2-&gt;baseParent();</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                        cl.<a class="code" href="structCollisionResolution.html#a2034dddc5d0801cf0b6376f2f0f8aa30">multiplier</a> = (int32_t) round(((s2-s2m)/cycleTime)-((s1-s1m)/cycleTime));</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                } <span class="keywordflow">else</span>  {</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                        cl.<a class="code" href="structCollisionResolution.html#a839f4a62c78c4722f7e9e89ddadffa15">a1</a> = m2-&gt;baseParent();</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                        cl.<a class="code" href="structCollisionResolution.html#a36aa751bee854b7c4867b3da5039599b">a2</a> = m1-&gt;baseParent();</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                        cl.<a class="code" href="structCollisionResolution.html#a2034dddc5d0801cf0b6376f2f0f8aa30">multiplier</a> = (int32_t) round(((s1-s1m)/cycleTime)-((s2-s2m)/cycleTime));</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                }</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        }</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="keywordflow">return</span> cl;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;}</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div>
<div class="line"><a name="l00282"></a><span class="lineno"><a class="line" href="classHeuristicAlgorithms.html#a528054eec6e2326d4a36f81ff38ee3d1">  282</a></span>&#160;<a class="code" href="structCollisionResolution.html">CollisionResolution</a> <a class="code" href="classHeuristicAlgorithms.html#a528054eec6e2326d4a36f81ff38ee3d1">HeuristicAlgorithms::resolveTheWorstCollision</a>(<span class="keyword">const</span> <a class="code" href="structPartialSolution.html">PartialSolution</a>&amp; ps, <span class="keyword">const</span> <a class="code" href="structOptimalTiming.html">OptimalTiming</a>&amp; ot, <span class="keyword">const</span> <a class="code" href="structSolution.html">Solution</a>&amp; s)<span class="keyword"> const  </span>{</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <a class="code" href="structCollisionResolution.html">CollisionResolution</a> ret;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; mit1 : ot.<a class="code" href="structOptimalTiming.html#a7484e949e2071d1e150aaade60768365">modeToStartAndDur</a>)   {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                <a class="code" href="classActivityMode.html">ActivityMode</a> *m1 = mit1.first;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                <span class="keywordtype">double</span> s1 = mit1.second.first, d1 = mit1.second.second;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                <span class="keyword">const</span> <span class="keyword">auto</span>&amp; mit2 = mMapping.collisionSearch.find(m1);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                <span class="keywordflow">if</span> (mit2 != mMapping.collisionSearch.cend())    {</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                        <span class="keywordflow">for</span> (<a class="code" href="classActivityMode.html">ActivityMode</a> *m2 : mit2-&gt;second)   {</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                                <span class="keyword">const</span> <span class="keyword">auto</span>&amp; sit = ot.<a class="code" href="structOptimalTiming.html#a7484e949e2071d1e150aaade60768365">modeToStartAndDur</a>.find(m2);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                                <span class="keywordflow">if</span> (sit != ot.<a class="code" href="structOptimalTiming.html#a7484e949e2071d1e150aaade60768365">modeToStartAndDur</a>.cend()) {</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                                        <span class="keywordtype">double</span> s2 = sit-&gt;second.first, d2 = sit-&gt;second.second;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                                        <span class="comment">// It is necessary to check the possible collision.</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                                        <a class="code" href="structCollisionResolution.html">CollisionResolution</a> cl = resolveCollision(m1, s1, d1, m2, s2, d2);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                                        <span class="keywordflow">if</span> (ret.<a class="code" href="structCollisionResolution.html#a4e89d61d52db1501a516f6879276de3f">intersection</a> &lt; cl.<a class="code" href="structCollisionResolution.html#a4e89d61d52db1501a516f6879276de3f">intersection</a>)</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                                                ret = cl;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                                }</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                        }</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                }</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        }</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;}</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div>
<div class="line"><a name="l00305"></a><span class="lineno"><a class="line" href="classHeuristicAlgorithms.html#a8ff0d590aa5f78e010fbfee385275e78">  305</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="classHeuristicAlgorithms.html#a8ff0d590aa5f78e010fbfee385275e78">HeuristicAlgorithms::heuristicLocationChanges</a>(<a class="code" href="structOptimalTiming.html">OptimalTiming</a>&amp; ot, <a class="code" href="structPartialSolution.html">PartialSolution</a>&amp; ps, <span class="keyword">const</span> vector&lt;vector&lt;Location*&gt;&gt;&amp; fixed, <span class="keywordtype">bool</span>&amp; solutionChanged)<span class="keyword"> const       </span>{</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        high_resolution_clock::time_point startLocHeur = high_resolution_clock::now();</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        solutionChanged = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        <span class="keywordtype">double</span> energyImprovement = 0.0;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        default_random_engine threadGenerator(rd());</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <span class="keywordtype">double</span> cycleTime = mLine.productionCycleTime();</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        uint32_t numberOfRobots = mLine.robots().size();</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="keywordtype">double</span> averageInputPower = ot.<a class="code" href="structOptimalTiming.html#a2c697a59113a6120436a02dda26af22a">totalEnergy</a>/(numberOfRobots*cycleTime);</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <span class="keywordflow">for</span> (uint32_t r = 0; r &lt; numberOfRobots; ++r)   {</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                uint32_t numberOfLocations = ps.<a class="code" href="structPartialSolution.html#a50fb6d7e10ac824afeeb56724d8c7468">locs</a>[r].size();</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                uniform_int_distribution&lt;uint32_t&gt; randomOffset(0u, 1u);</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                <span class="keywordflow">for</span> (uint32_t i = randomOffset(threadGenerator); i+1u &lt; numberOfLocations; i += 2u)     {</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                        <a class="code" href="classLocation.html">Location</a> *bestLoc = ps.<a class="code" href="structPartialSolution.html#a50fb6d7e10ac824afeeb56724d8c7468">locs</a>[r][i], *selLoc = bestLoc;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                        assert(bestLoc != <span class="keyword">nullptr</span> &amp;&amp; bestLoc-&gt;parent() != <span class="keyword">nullptr</span> &amp;&amp; <span class="stringliteral">&quot;Invalid initialization of the robotic cell!&quot;</span>);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                        <span class="keywordflow">if</span> (count(fixed[r].cbegin(), fixed[r].cend(), bestLoc) == 0)    {</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                                <span class="comment">// It is possible to change location without spatial compatibility breaking.</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                                int64_t prevIdxMv = (i &gt; 0 ? i-1 : ps.<a class="code" href="structPartialSolution.html#a4bc15548f2b4e6ae425952245ba3cca8">mvs</a>[r].size()-1);</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                                int64_t prevIdxLoc = (i &gt; 0 ? i-1 : numberOfLocations-2);</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                                assert(prevIdxMv &gt;= 0 &amp;&amp; prevIdxLoc &gt;= 0 &amp;&amp; <span class="stringliteral">&quot;Invalid index calculation, were the vectors initialized?!&quot;</span>);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                                <a class="code" href="classMovement.html">Movement</a> *bestEntering = ps.<a class="code" href="structPartialSolution.html#a4bc15548f2b4e6ae425952245ba3cca8">mvs</a>[r][prevIdxMv], *bestLeaving = ps.<a class="code" href="structPartialSolution.html#a4bc15548f2b4e6ae425952245ba3cca8">mvs</a>[r][i];</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                                <a class="code" href="classRobotPowerMode.html">RobotPowerMode</a> *selectedPowerSavingMode = ps.<a class="code" href="structPartialSolution.html#a011d753a484c4fa2e0bf803a49204ea6">pwrms</a>[r][i];</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                                <a class="code" href="classLocation.html">Location</a> *prevLoc = ps.<a class="code" href="structPartialSolution.html#a50fb6d7e10ac824afeeb56724d8c7468">locs</a>[r][prevIdxLoc], *nextLoc = ps.<a class="code" href="structPartialSolution.html#a50fb6d7e10ac824afeeb56724d8c7468">locs</a>[r][i+1];</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                                <span class="comment">// Get the current timing...</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                                <span class="keywordtype">double</span> bestStart1 = ot.<a class="code" href="structOptimalTiming.html#a0723b96a68af48e083145b22f6102cf1">startMvs</a>[r][prevIdxMv], bestDur1 = ot.<a class="code" href="structOptimalTiming.html#a826c23e5865dcc4291085d06cfc9bd34">durMvs</a>[r][prevIdxMv];      <span class="comment">// entering</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                                <span class="keywordtype">double</span> bestStart2 = ot.<a class="code" href="structOptimalTiming.html#a8d8fa55e34745670850977414adbdd6c">startLocs</a>[r][i], bestDur2 = ot.<a class="code" href="structOptimalTiming.html#a1eaccbd58b39bfd0c4060269d7254407">durLocs</a>[r][i];    <span class="comment">// inner location</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                                <span class="keywordtype">double</span> bestStart3 = ot.<a class="code" href="structOptimalTiming.html#a0723b96a68af48e083145b22f6102cf1">startMvs</a>[r][i], bestDur3 = ot.<a class="code" href="structOptimalTiming.html#a826c23e5865dcc4291085d06cfc9bd34">durMvs</a>[r][i];      <span class="comment">// leaving</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                                <span class="keywordtype">double</span> stationaryDuration = bestDur2, dynamicDuration = bestDur1+bestDur3;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                                <span class="comment">// Remove a part from a robot gantt to update it later.</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                                ot.<a class="code" href="structOptimalTiming.html#a7484e949e2071d1e150aaade60768365">modeToStartAndDur</a>.erase(bestEntering); ot.<a class="code" href="structOptimalTiming.html#a56957ffcae1b9fbe374243eae121834b">actToStartAndDur</a>.erase(bestEntering-&gt;parent());</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                                ot.<a class="code" href="structOptimalTiming.html#a7484e949e2071d1e150aaade60768365">modeToStartAndDur</a>.erase(bestLoc); ot.<a class="code" href="structOptimalTiming.html#a56957ffcae1b9fbe374243eae121834b">actToStartAndDur</a>.erase(bestLoc-&gt;parent());</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                                ot.<a class="code" href="structOptimalTiming.html#a7484e949e2071d1e150aaade60768365">modeToStartAndDur</a>.erase(bestLeaving); ot.<a class="code" href="structOptimalTiming.html#a56957ffcae1b9fbe374243eae121834b">actToStartAndDur</a>.erase(bestLeaving-&gt;parent());</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                                <span class="comment">// Calculate the current energy consumption.</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                                <span class="keywordtype">double</span> initialEnergyConsumption = bestEntering-&gt;<a class="code" href="classMovement.html#a9009b6cf2a9e117e89d99e00c47540a2">energyConsumption</a>(bestDur1), bestEnergyConsumption = F64_INF;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                                initialEnergyConsumption += bestLoc-&gt;<a class="code" href="classLocation.html#a220e8f7528572f0035823461e10b7fba">energyConsumption</a>(stationaryDuration, selectedPowerSavingMode);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                                initialEnergyConsumption += bestLeaving-&gt;energyConsumption(bestDur3);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                                <span class="comment">// Try to select another location if it is possible and more energy efficient.</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                                <span class="keywordflow">for</span> (<a class="code" href="classLocation.html">Location</a> *loc : selLoc-&gt;parent()-&gt;locations())     {</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                                        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; sit1 = mMapping.locationsToMovement.find({prevLoc, loc});</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                                        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; sit2 = mMapping.locationsToMovement.find({loc, nextLoc});</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                                        <span class="keywordflow">if</span> (sit1 != mMapping.locationsToMovement.cend() &amp;&amp; sit2 != mMapping.locationsToMovement.cend()) {</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                                                <a class="code" href="classMovement.html">Movement</a> *entering = sit1-&gt;second, *leaving = sit2-&gt;second;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                                                <span class="keywordtype">bool</span> callGoldenSearch = entering-&gt;minDuration()+leaving-&gt;minDuration() &lt; dynamicDuration+<a class="code" href="NumericConstants_8h.html#aeff822503333aed003c2ce1c6673295b">TIME_ERR</a>;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                                                callGoldenSearch = callGoldenSearch &amp;&amp; entering-&gt;maxDuration()+leaving-&gt;maxDuration()+TIME_ERR &gt; dynamicDuration;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                                                <span class="keywordflow">if</span> (callGoldenSearch == <span class="keyword">true</span>)   {</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                                                        <span class="comment">// Calculate total energy required for the pair of movements and location.</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                                                        <a class="code" href="classUnimodalFunctionHeuristic.html">UnimodalFunctionHeuristic</a> unifFce(entering, leaving, dynamicDuration);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                                                        <span class="keyword">const</span> pair&lt;double, double&gt;&amp; res = <a class="code" href="Algorithms_8h.html#a495ffa08b152c8a9b96ed636a9a46a2b">goldenSearch</a>(unifFce);</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                                                        <span class="keywordtype">double</span> totalEnergy = res.second;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                                                        totalEnergy += loc-&gt;energyConsumption(stationaryDuration, selectedPowerSavingMode);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                                                        <span class="comment">// Get new timing for &#39;mv1 -&gt; loc2 -&gt; mv3&#39;.</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                                                        <span class="keyword">const</span> pair&lt;double, double&gt;&amp; mvsDurs = unifFce.<a class="code" href="classUnimodalFunctionHeuristic.html#a14bfec242b90d2ff37a5b85fc0d07be8">durations</a>(res.first);</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                                                        <span class="keywordtype">double</span> s1 = ot.<a class="code" href="structOptimalTiming.html#a0723b96a68af48e083145b22f6102cf1">startMvs</a>[r][prevIdxMv], d1 = mvsDurs.first;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                                                        <span class="keywordtype">double</span> s2 = s1+d1, d2 = stationaryDuration;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                                                        <span class="keywordtype">double</span> s3 = s2+d2, d3 = mvsDurs.second;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                                                        <span class="keywordflow">if</span> (loc-&gt;parent()-&gt;lastInCycle())</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                                                                s3 -= cycleTime;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                                                        <span class="comment">// Estimate time violation after switching the location and penalize it in terms of energy.</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                                                        vector&lt;ActivityModeInfo&gt; partOfGantt = { { entering, s1, d1 }, { loc, s2, d2 }, { leaving, s3, d3 } };</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                                                        <span class="keywordtype">double</span> timePenalty = calculateBreakagePenalty(partOfGantt, ot);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                                                        totalEnergy += mPenaltyMultiplier*averageInputPower*timePenalty;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                                                        <span class="comment">// Decide whether it is an improvement or not...</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                                                        <span class="keywordflow">if</span> (totalEnergy &lt; bestEnergyConsumption)        {</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                                                                bestEnergyConsumption = totalEnergy;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                                                                bestEntering = entering; bestLoc = loc; bestLeaving = leaving;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                                                                bestStart1 = s1; bestDur1 = d1; bestStart2 = s2; bestDur2 = d2; bestStart3 = s3; bestDur3 = d3;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                                                        }</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                                                }</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                                        }</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                                }</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                                <span class="keywordflow">if</span> (bestEnergyConsumption &lt; F64_INF)    {</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                                        <span class="comment">// Add an energy improvement after switching a location.</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                                        energyImprovement += initialEnergyConsumption-bestEnergyConsumption;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                                        <span class="comment">// Update the part of the Gantt according the the best selected location.</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                                        ps.<a class="code" href="structPartialSolution.html#a4bc15548f2b4e6ae425952245ba3cca8">mvs</a>[r][prevIdxMv] = bestEntering;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                                        ot.<a class="code" href="structOptimalTiming.html#a826c23e5865dcc4291085d06cfc9bd34">durMvs</a>[r][prevIdxMv] = bestDur1;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                                        setValue(ot.<a class="code" href="structOptimalTiming.html#a7484e949e2071d1e150aaade60768365">modeToStartAndDur</a>, bestEntering, {bestStart1, bestDur1}, caller());</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                                        setValue(ot.<a class="code" href="structOptimalTiming.html#a56957ffcae1b9fbe374243eae121834b">actToStartAndDur</a>, bestEntering-&gt;parent(), {bestStart1, bestDur1}, caller());</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                                        ps.<a class="code" href="structPartialSolution.html#a50fb6d7e10ac824afeeb56724d8c7468">locs</a>[r][i] = bestLoc;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                                        <span class="keywordflow">if</span> (i == 0)</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                                                ps.<a class="code" href="structPartialSolution.html#a50fb6d7e10ac824afeeb56724d8c7468">locs</a>[r].back() = ps.<a class="code" href="structPartialSolution.html#a50fb6d7e10ac824afeeb56724d8c7468">locs</a>[r].front();</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                                        ot.<a class="code" href="structOptimalTiming.html#a8d8fa55e34745670850977414adbdd6c">startLocs</a>[r][i] = bestStart2;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                                        setValue(ot.<a class="code" href="structOptimalTiming.html#a7484e949e2071d1e150aaade60768365">modeToStartAndDur</a>, bestLoc, {bestStart2, bestDur2}, caller());</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                                        setValue(ot.<a class="code" href="structOptimalTiming.html#a56957ffcae1b9fbe374243eae121834b">actToStartAndDur</a>, bestLoc-&gt;parent(), {bestStart2, bestDur2}, caller());</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                                        ps.<a class="code" href="structPartialSolution.html#a4bc15548f2b4e6ae425952245ba3cca8">mvs</a>[r][i] = bestLeaving;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                                        ot.<a class="code" href="structOptimalTiming.html#a0723b96a68af48e083145b22f6102cf1">startMvs</a>[r][i] = bestStart3;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                                        ot.<a class="code" href="structOptimalTiming.html#a826c23e5865dcc4291085d06cfc9bd34">durMvs</a>[r][i] = bestDur3;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                                        setValue(ot.<a class="code" href="structOptimalTiming.html#a7484e949e2071d1e150aaade60768365">modeToStartAndDur</a>, bestLeaving, {bestStart3, bestDur3}, caller());</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                                        setValue(ot.<a class="code" href="structOptimalTiming.html#a56957ffcae1b9fbe374243eae121834b">actToStartAndDur</a>, bestLeaving-&gt;parent(), {bestStart3, bestDur3}, caller());</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                                        <span class="keywordflow">if</span> (bestLoc != selLoc)</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                                                solutionChanged = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                                        <span class="keywordflow">throw</span> <a class="code" href="classSolverException.html">SolverException</a>(caller(), <span class="stringliteral">&quot;Cannot select a suitable location, either the heuristic bug or invalid partial solution!&quot;</span>);</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                                }</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                        }</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                }</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        }</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        mKB.recordLocHeurCall(duration_cast&lt;duration&lt;double&gt;&gt;(high_resolution_clock::now()-startLocHeur).count());</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="keywordflow">return</span> energyImprovement;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;}</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div>
<div class="line"><a name="l00410"></a><span class="lineno"><a class="line" href="classHeuristicAlgorithms.html#a533a4de85081bfc9bd1b545b5c228a71">  410</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="classHeuristicAlgorithms.html#a533a4de85081bfc9bd1b545b5c228a71">HeuristicAlgorithms::heuristicPowerModeSelection</a>(<span class="keyword">const</span> <a class="code" href="structOptimalTiming.html">OptimalTiming</a>&amp; ot, <a class="code" href="structPartialSolution.html">PartialSolution</a>&amp; ps, <a class="code" href="classTabuList.html">TabuList</a>&amp; tabuList, <span class="keywordtype">bool</span>&amp; solutionChanged)<span class="keyword"> const  </span>{</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        high_resolution_clock::time_point startPwrmHeur = high_resolution_clock::now();</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        solutionChanged = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <span class="keyword">const</span> vector&lt;Robot*&gt;&amp; robots = mLine.robots();</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        <span class="keywordtype">double</span> cycleTime = mLine.productionCycleTime();</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        uint32_t numberOfRobots = robots.size();</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        vector&lt;uint32_t&gt; numberOfLocations(numberOfRobots);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        vector&lt;vector&lt;ActivityModeInfo&gt;&gt; info(numberOfRobots);</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        vector&lt;double&gt; consumedEnergyPerRobot(numberOfRobots, 0.0);</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        <span class="keywordtype">double</span> averageInputPower = ot.<a class="code" href="structOptimalTiming.html#a2c697a59113a6120436a02dda26af22a">totalEnergy</a>/(numberOfRobots*cycleTime);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        <span class="keywordflow">for</span> (uint32_t r = 0; r &lt; numberOfRobots; ++r)   {</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                numberOfLocations[r] = ps.<a class="code" href="structPartialSolution.html#a50fb6d7e10ac824afeeb56724d8c7468">locs</a>[r].size();</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                <span class="keywordflow">for</span> (uint32_t l = 0; l+1 &lt; numberOfLocations[r]; ++l)   {</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                        <a class="code" href="classLocation.html">Location</a> *loc = ps.<a class="code" href="structPartialSolution.html#a50fb6d7e10ac824afeeb56724d8c7468">locs</a>[r][l];</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                        <a class="code" href="classRobotPowerMode.html">RobotPowerMode</a> *pwrm = ps.<a class="code" href="structPartialSolution.html#a011d753a484c4fa2e0bf803a49204ea6">pwrms</a>[r][l];</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                        <span class="keywordtype">double</span> startLoc = ot.<a class="code" href="structOptimalTiming.html#a8d8fa55e34745670850977414adbdd6c">startLocs</a>[r][l], durLoc = ot.<a class="code" href="structOptimalTiming.html#a1eaccbd58b39bfd0c4060269d7254407">durLocs</a>[r][l], energyLoc = loc-&gt;<a class="code" href="classLocation.html#a220e8f7528572f0035823461e10b7fba">energyConsumption</a>(durLoc, pwrm);</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                        info[r].push_back({loc, pwrm, energyLoc, startLoc, durLoc,</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                                        max(pwrm-&gt;minimalDelay(), loc-&gt;parent()-&gt;minAbsDuration()), loc-&gt;parent()-&gt;maxAbsDuration()});</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                        consumedEnergyPerRobot[r] += energyLoc;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                }</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                <span class="keywordflow">for</span> (uint32_t l = 0; l+1 &lt; numberOfLocations[r]; ++l)   {</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                        <a class="code" href="classMovement.html">Movement</a> *mv = ps.<a class="code" href="structPartialSolution.html#a4bc15548f2b4e6ae425952245ba3cca8">mvs</a>[r][l];</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                        <span class="keywordtype">double</span> startMv = ot.<a class="code" href="structOptimalTiming.html#a0723b96a68af48e083145b22f6102cf1">startMvs</a>[r][l], durMv = ot.<a class="code" href="structOptimalTiming.html#a826c23e5865dcc4291085d06cfc9bd34">durMvs</a>[r][l], energyMv = mv-&gt;<a class="code" href="classMovement.html#a9009b6cf2a9e117e89d99e00c47540a2">energyConsumption</a>(durMv);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                        info[r].push_back({mv, <span class="keyword">nullptr</span>, energyMv, startMv, durMv, mv-&gt;minDuration(), mv-&gt;maxDuration()});</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                        consumedEnergyPerRobot[r] += energyMv;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                }</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        }</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        <span class="keywordtype">double</span> originalEnergyConsumption = accumulate(consumedEnergyPerRobot.cbegin(), consumedEnergyPerRobot.cend(), 0.0);</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        vector&lt;ModeSwitchInfo&gt; candidates;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <span class="keywordflow">for</span> (uint32_t r = 0; r &lt; numberOfRobots; ++r)   {</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                <span class="keywordflow">for</span> (uint32_t l = 0; l+1 &lt; numberOfLocations[r]; ++l)   {</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                        <a class="code" href="classLocation.html">Location</a> *selLoc = ps.<a class="code" href="structPartialSolution.html#a50fb6d7e10ac824afeeb56724d8c7468">locs</a>[r][l];</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                        <a class="code" href="classRobotPowerMode.html">RobotPowerMode</a> *selMode = ps.<a class="code" href="structPartialSolution.html#a011d753a484c4fa2e0bf803a49204ea6">pwrms</a>[r][l];</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                        <a class="code" href="classStaticActivity.html">StaticActivity</a> *selAct = selLoc-&gt;parent();</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                        <span class="keywordflow">for</span> (<a class="code" href="classRobotPowerMode.html">RobotPowerMode</a> *pwrm : robots[r]-&gt;powerModes())    {</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                                <span class="keywordflow">if</span> (pwrm != selMode &amp;&amp; pwrm-&gt;minimalDelay() &lt;= selAct-&gt;maxAbsDuration())        {</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                                        vector&lt;ActivityModeInfo&gt; robotTiming = info[r];</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                                        <span class="keywordtype">double</span> minReqDur = max(selAct-&gt;minAbsDuration(), pwrm-&gt;minimalDelay());</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                                        robotTiming[l].pwrm = pwrm;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                                        robotTiming[l].energy = selLoc-&gt;<a class="code" href="classLocation.html#a220e8f7528572f0035823461e10b7fba">energyConsumption</a>(minReqDur, pwrm);</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                                        robotTiming[l].minDuration = robotTiming[l].curDuration = minReqDur;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                                        robotTiming[l].maxDuration = selAct-&gt;maxAbsDuration();</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                                        <span class="keywordtype">double</span> energyScaledRobot = scaleGanttToCycleTime(robotTiming);</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                                        <span class="keywordflow">if</span> (energyScaledRobot &lt; F64_INF)        {</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                                                <span class="keywordtype">double</span> timePenalty = calculateBreakagePenalty(robotTiming, ot);</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                                                <span class="keywordtype">double</span> estimatedEnergy = originalEnergyConsumption-consumedEnergyPerRobot[r];</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                                                estimatedEnergy += energyScaledRobot+mPenaltyMultiplier*averageInputPower*timePenalty;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                                                candidates.emplace_back(r, l, selLoc, selMode, pwrm, estimatedEnergy);</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                                        }</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                                }</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                        }</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                }</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        }</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        <span class="keywordtype">double</span> energyImprovement = 0.0;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        <span class="keywordflow">if</span> (!candidates.empty())        {</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                <a class="code" href="structModeSwitchInfo.html">ModeSwitchInfo</a> selected;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                <span class="comment">// Sort candidates according their energy estimation.</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                sort(candidates.begin(), candidates.end());</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                <span class="comment">// Select the best candidate not in tabu list.</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                <span class="keyword">const</span> <span class="keyword">auto</span>&amp; sit = find_if(candidates.cbegin(), candidates.cend(), [&amp;](<span class="keyword">const</span> <a class="code" href="structModeSwitchInfo.html">ModeSwitchInfo</a>&amp; i) { <span class="keywordflow">return</span> !tabuList.<a class="code" href="classTabuList.html#a3e2b6a33de95d75e4d93c3c76e267677">isTabu</a>(i.loc, i.from, i.to); });</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                <span class="keywordflow">if</span> (sit != candidates.cend())   {</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                        selected = *sit;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                        <span class="comment">// The selected mode switch is being added to the tabu list.</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                        tabuList.<a class="code" href="classTabuList.html#a4690b98e5a03e0adc27233b25517015d">addTabu</a>(selected.<a class="code" href="structModeSwitchInfo.html#a42f3f53b357394ff53f7fd9b1cc0b85b">loc</a>, selected.<a class="code" href="structModeSwitchInfo.html#abb3dcb121fafaf7ce0cd2fba6207da99">from</a>, selected.<a class="code" href="structModeSwitchInfo.html#a314005046cd12abbcc219f0c96447fbe">to</a>);</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                        <span class="comment">// All candidates are tabu, random selection and tabu list diversification.</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                        default_random_engine threadGenerator(rd());</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                        uniform_int_distribution&lt;uint32_t&gt; randSel(0, candidates.size()-1);</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                        uint32_t selIdx = randSel(threadGenerator);</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                        selected = candidates[selIdx];</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                        tabuList.<a class="code" href="classTabuList.html#ae181632961511ac1273b7b3a1ea9045e">diversify</a>();</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                }</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                ps.<a class="code" href="structPartialSolution.html#a011d753a484c4fa2e0bf803a49204ea6">pwrms</a>[selected.<a class="code" href="structModeSwitchInfo.html#af4146cc2a0f29f63abef99ae641f9cf9">robotIdx</a>][selected.<a class="code" href="structModeSwitchInfo.html#a8a031f3033c042750e589937da297d46">locationIdx</a>] = selected.<a class="code" href="structModeSwitchInfo.html#a314005046cd12abbcc219f0c96447fbe">to</a>;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                <span class="keywordflow">if</span> (selected.<a class="code" href="structModeSwitchInfo.html#a8a031f3033c042750e589937da297d46">locationIdx</a> == 0)</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                        ps.<a class="code" href="structPartialSolution.html#a011d753a484c4fa2e0bf803a49204ea6">pwrms</a>[selected.<a class="code" href="structModeSwitchInfo.html#af4146cc2a0f29f63abef99ae641f9cf9">robotIdx</a>].back() = ps.<a class="code" href="structPartialSolution.html#a011d753a484c4fa2e0bf803a49204ea6">pwrms</a>[selected.<a class="code" href="structModeSwitchInfo.html#af4146cc2a0f29f63abef99ae641f9cf9">robotIdx</a>].front();</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                energyImprovement = originalEnergyConsumption-selected.<a class="code" href="structModeSwitchInfo.html#a592fec175c2a754eed72120d78fcfe53">estimatedEnergy</a>;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                solutionChanged = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        }</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        mKB.recordPwrmHeurCall(duration_cast&lt;duration&lt;double&gt;&gt;(high_resolution_clock::now()-startPwrmHeur).count());</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        <span class="keywordflow">return</span> energyImprovement;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;}</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div>
<div class="line"><a name="l00505"></a><span class="lineno"><a class="line" href="classHeuristicAlgorithms.html#a158982c033e99d89c93dba6c29f32e59">  505</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="classHeuristicAlgorithms.html#a158982c033e99d89c93dba6c29f32e59">HeuristicAlgorithms::scaleGanttToCycleTime</a>(vector&lt;ActivityModeInfo&gt;&amp; robotGantt)<span class="keyword"> const   </span>{</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        <span class="keywordtype">double</span> sumOfDur = 0.0;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        <span class="keywordtype">double</span> robotEnergy = 0.0;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <span class="keywordtype">double</span> cycleTime = mLine.productionCycleTime();</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="structActivityModeInfo.html">ActivityModeInfo</a>&amp; ami : robotGantt)  {</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                sumOfDur += ami.curDuration;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                robotEnergy += ami.energy;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        }</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        <span class="keywordtype">double</span> durDiff = sumOfDur-cycleTime;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        vector&lt;bool&gt; changeAllowed(robotGantt.size(), <span class="keyword">false</span>);</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        <span class="keywordtype">bool</span> shorten = durDiff &gt; 0.0, prolong = durDiff &lt; 0.0;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="keywordflow">while</span> (abs(durDiff) &gt; <a class="code" href="NumericConstants_8h.html#a3ebebeda85a70b80e3aaa937ed8fb7a3">TIME_TOL</a>) {</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                <span class="keywordtype">double</span> maxFeasChange = F64_INF;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                uint32_t numberOfModifiable = 0u;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; robotGantt.size(); ++i)        {</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                        <span class="keywordflow">if</span> (shorten &amp;&amp; robotGantt[i].curDuration &gt; robotGantt[i].minDuration)   {</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                                maxFeasChange = min(maxFeasChange, robotGantt[i].curDuration-robotGantt[i].minDuration);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                                changeAllowed[i] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                                ++numberOfModifiable;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (prolong &amp;&amp; robotGantt[i].curDuration &lt; robotGantt[i].maxDuration)    {</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                                maxFeasChange = min(maxFeasChange, robotGantt[i].maxDuration-robotGantt[i].curDuration);</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                                changeAllowed[i] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                                ++numberOfModifiable;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                                changeAllowed[i] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                        }</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                }</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                <span class="keywordflow">if</span> (numberOfModifiable &gt; 0 &amp;&amp; maxFeasChange &lt; F64_INF)  {</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                        maxFeasChange = min(abs(durDiff)/numberOfModifiable, maxFeasChange);</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                        <span class="keywordflow">if</span> (shorten)</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                                maxFeasChange = -maxFeasChange;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                        <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; robotGantt.size(); ++i)        {</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                                <span class="keywordflow">if</span> (changeAllowed[i])   {</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                                        <span class="keywordtype">double</span> energyUpdated = F64_INF;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                                        <a class="code" href="classActivityMode.html">ActivityMode</a>* mode = robotGantt[i].mode;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                                        <span class="keywordtype">double</span> durationUpdated = robotGantt[i].curDuration + maxFeasChange;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                                        assert(robotGantt[i].minDuration &lt;= durationUpdated+<a class="code" href="NumericConstants_8h.html#aeff822503333aed003c2ce1c6673295b">TIME_ERR</a></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                                                        &amp;&amp; durationUpdated &lt;= robotGantt[i].maxDuration+<a class="code" href="NumericConstants_8h.html#aeff822503333aed003c2ce1c6673295b">TIME_ERR</a> &amp;&amp; <span class="stringliteral">&quot;Invalid scaling of the robot graph!&quot;</span>);</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                                        <a class="code" href="classLocation.html">Location</a> *loc = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classLocation.html">Location</a>*<span class="keyword">&gt;</span>(mode);</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                                        <span class="keywordflow">if</span> (loc != <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                                                energyUpdated = loc-&gt;<a class="code" href="classLocation.html#a220e8f7528572f0035823461e10b7fba">energyConsumption</a>(durationUpdated, robotGantt[i].pwrm);</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                                        <a class="code" href="classMovement.html">Movement</a> *mv = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classMovement.html">Movement</a>*<span class="keyword">&gt;</span>(mode);</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                                        <span class="keywordflow">if</span> (mv != <span class="keyword">nullptr</span>)</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                                                energyUpdated = mv-&gt;<a class="code" href="classMovement.html#a9009b6cf2a9e117e89d99e00c47540a2">energyConsumption</a>(durationUpdated);</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                                        robotEnergy += energyUpdated-robotGantt[i].energy;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                                        robotGantt[i].energy = energyUpdated;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                                        robotGantt[i].curDuration = durationUpdated;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                                }</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                        }</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="preprocessor">                        #ifndef NDEBUG</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                        <span class="keywordtype">double</span> minCycleTime = 0.0;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                        <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="structActivityModeInfo.html">ActivityModeInfo</a>&amp; ami : robotGantt)</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                                minCycleTime += ami.minDuration;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                        <span class="keywordflow">if</span> (minCycleTime+<a class="code" href="NumericConstants_8h.html#a3ebebeda85a70b80e3aaa937ed8fb7a3">TIME_TOL</a> &lt; cycleTime)</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                                <span class="keywordflow">throw</span> <a class="code" href="classSolverException.html">SolverException</a>(caller(), <span class="stringliteral">&quot;A bug in the method, the gantt should be scalable!&quot;</span>);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="preprocessor">                        #endif</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                        <span class="comment">// Cannot be scaled -&gt; it will lead to infeasible solution.</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                        <span class="keywordflow">return</span> F64_INF;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                }</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                durDiff += numberOfModifiable*maxFeasChange;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        }</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        <span class="comment">// Update start times.</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        sort(robotGantt.begin(), robotGantt.end());</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        <span class="keywordflow">for</span> (uint32_t i = 0; i+1 &lt; robotGantt.size(); ++i)</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                robotGantt[i+1].curStartTime = robotGantt[i].curStartTime+robotGantt[i].curDuration;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="preprocessor">        #ifndef NDEBUG</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        <span class="keywordtype">double</span> checkCycleTime = 0.0;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="structActivityModeInfo.html">ActivityModeInfo</a>&amp; ami : robotGantt)  {</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                checkCycleTime += ami.curDuration;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                <span class="keywordflow">if</span> (ami.minDuration &gt; ami.curDuration+<a class="code" href="NumericConstants_8h.html#a3ebebeda85a70b80e3aaa937ed8fb7a3">TIME_TOL</a> || ami.maxDuration+<a class="code" href="NumericConstants_8h.html#a3ebebeda85a70b80e3aaa937ed8fb7a3">TIME_TOL</a> &lt; ami.curDuration)</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                        <span class="keywordflow">throw</span> <a class="code" href="classSolverException.html">SolverException</a>(caller(), <span class="stringliteral">&quot;Invalid update step of the algorithm.&quot;</span>);</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        }</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        <span class="keywordflow">if</span> (abs(checkCycleTime-cycleTime) &gt; <a class="code" href="NumericConstants_8h.html#a3ebebeda85a70b80e3aaa937ed8fb7a3">TIME_TOL</a>)</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                <span class="keywordflow">throw</span> <a class="code" href="classSolverException.html">SolverException</a>(caller(), <span class="stringliteral">&quot;The robot gantt was not scaled to the desired cycle time, a bug in the algorithm!&quot;</span>);</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="preprocessor">        #endif</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        <span class="keywordflow">return</span> robotEnergy;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;}</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;</div>
<div class="line"><a name="l00599"></a><span class="lineno"><a class="line" href="classHeuristicAlgorithms.html#ae601403b9ed04c839f484013ca95efa0">  599</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="classHeuristicAlgorithms.html#ae601403b9ed04c839f484013ca95efa0">HeuristicAlgorithms::calculateBreakagePenalty</a>(<span class="keyword">const</span> std::vector&lt;ActivityModeInfo&gt;&amp; robotGantt, <span class="keyword">const</span> <a class="code" href="structOptimalTiming.html">OptimalTiming</a>&amp; ot)<span class="keyword"> const    </span>{</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        <span class="keywordtype">double</span> timePenalty = 0.0;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        <span class="keywordtype">double</span> cycleTime = mLine.productionCycleTime();</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; robotGantt.size(); ++i)        {</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                <a class="code" href="classActivityMode.html">ActivityMode</a> *m1 = robotGantt[i].mode;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                <span class="keywordtype">double</span> s1 = robotGantt[i].curStartTime, d1 = robotGantt[i].curDuration;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                <span class="comment">// check collisions</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                <span class="keyword">const</span> <span class="keyword">auto</span>&amp; sit = mMapping.collisionSearch.find(m1);</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                <span class="keywordflow">if</span> (sit != mMapping.collisionSearch.cend())     {</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                        <span class="keywordflow">for</span> (<a class="code" href="classActivityMode.html">ActivityMode</a> *m2 : sit-&gt;second)    {</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                                <span class="keyword">const</span> <span class="keyword">auto</span>&amp; mit = ot.<a class="code" href="structOptimalTiming.html#a7484e949e2071d1e150aaade60768365">modeToStartAndDur</a>.find(m2);</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                                <span class="keywordflow">if</span> (mit != ot.<a class="code" href="structOptimalTiming.html#a7484e949e2071d1e150aaade60768365">modeToStartAndDur</a>.cend()) {</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                                        <span class="keywordtype">double</span> s2 = mit-&gt;second.first, d2 = mit-&gt;second.second;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                                        <a class="code" href="structCollisionResolution.html">CollisionResolution</a> cl = resolveCollision(m1, s1, d1, m2, s2, d2);</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                                        timePenalty += cl.<a class="code" href="structCollisionResolution.html#a4e89d61d52db1501a516f6879276de3f">intersection</a>;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                                }</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                        }</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                }</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                <span class="comment">// check time lags</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                uint32_t idx = 0;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                <span class="keywordflow">for</span> (<span class="keyword">const</span> map&lt;<a class="code" href="classActivity.html">Activity</a>*, vector&lt;TimeLag&gt;&gt;* mapPtr : { &amp;mMapping.timeLagsFromAct, &amp;mMapping.timeLagsToAct })    {</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; sit1 = mapPtr-&gt;find(m1-&gt;baseParent());</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                        <span class="keywordflow">if</span> (sit1 != mapPtr-&gt;cend())     {</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                                <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classTimeLag.html">TimeLag</a>&amp; tl : sit1-&gt;second)  {</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                                        <a class="code" href="classActivity.html">Activity</a> *relAct = (idx == 0 ? tl.to() : tl.from());</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                                        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; mit = ot.<a class="code" href="structOptimalTiming.html#a56957ffcae1b9fbe374243eae121834b">actToStartAndDur</a>.find(relAct);</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                                        <span class="keywordflow">if</span> (mit != ot.<a class="code" href="structOptimalTiming.html#a56957ffcae1b9fbe374243eae121834b">actToStartAndDur</a>.cend())  {</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                                                <span class="keywordtype">double</span> s2 = mit-&gt;second.first;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                                                <span class="keywordflow">if</span> (idx == 0)</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                                                        timePenalty += max(s1-s2+tl.length()-tl.height()*cycleTime, 0.0);</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                                                        timePenalty += max(s2-s1+tl.length()-tl.height()*cycleTime, 0.0);</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                                        }</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                                }</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                        }</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                        ++idx;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                }</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;        }</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        assert(timePenalty &gt;= 0.0 &amp;&amp; <span class="stringliteral">&quot;Time penalty must be positive, a bug in the algorithm!&quot;</span>);</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        <span class="keywordflow">return</span> timePenalty;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;}</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;</div>
<div class="ttc" id="classMovement_html"><div class="ttname"><a href="classMovement.html">Movement</a></div><div class="ttdoc">The instance of the class corresponds to a robot movement between two coordinates. </div><div class="ttdef"><b>Definition:</b> <a href="RoboticLine_8h_source.html#l00133">RoboticLine.h:133</a></div></div>
<div class="ttc" id="classUnimodalFunctionHeuristic_html_ae4bd38470fb5aba06df52d451d4934c9"><div class="ttname"><a href="classUnimodalFunctionHeuristic.html#ae4bd38470fb5aba06df52d451d4934c9">UnimodalFunctionHeuristic::mFromX</a></div><div class="ttdeci">double mFromX</div><div class="ttdoc">The minimal duration of the first movement. </div><div class="ttdef"><b>Definition:</b> <a href="HeuristicAlgorithms_8cpp_source.html#l00096">HeuristicAlgorithms.cpp:96</a></div></div>
<div class="ttc" id="classTabuList_html_a3e2b6a33de95d75e4d93c3c76e267677"><div class="ttname"><a href="classTabuList.html#a3e2b6a33de95d75e4d93c3c76e267677">TabuList::isTabu</a></div><div class="ttdeci">bool isTabu(Location *l, RobotPowerMode *from, RobotPowerMode *to) const </div><div class="ttdoc">It checks whether the modification of a partial solution is allowed, i.e. the move/modification is no...</div><div class="ttdef"><b>Definition:</b> <a href="DataStructures_8h_source.html#l00265">DataStructures.h:265</a></div></div>
<div class="ttc" id="structOptimalTiming_html_a1eaccbd58b39bfd0c4060269d7254407"><div class="ttname"><a href="structOptimalTiming.html#a1eaccbd58b39bfd0c4060269d7254407">OptimalTiming::durLocs</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; double &gt; &gt; durLocs</div><div class="ttdoc">Durations assigned to static activities&#39; locations. </div><div class="ttdef"><b>Definition:</b> <a href="DataStructures_8h_source.html#l00154">DataStructures.h:154</a></div></div>
<div class="ttc" id="classTabuList_html_a4690b98e5a03e0adc27233b25517015d"><div class="ttname"><a href="classTabuList.html#a4690b98e5a03e0adc27233b25517015d">TabuList::addTabu</a></div><div class="ttdeci">void addTabu(Location *l, RobotPowerMode *from, RobotPowerMode *to)</div><div class="ttdoc">It adds a performed modification into the tabu list. </div><div class="ttdef"><b>Definition:</b> <a href="DataStructures_8h_source.html#l00274">DataStructures.h:274</a></div></div>
<div class="ttc" id="structSolution_html_af8d9eff375b22d79d5a05ee49908dce6"><div class="ttname"><a href="structSolution.html#af8d9eff375b22d79d5a05ee49908dce6">Solution::totalEnergy</a></div><div class="ttdeci">double totalEnergy</div><div class="ttdoc">The amount of energy required per robot cycle. </div><div class="ttdef"><b>Definition:</b> <a href="Solution_8h_source.html#l00057">Solution.h:57</a></div></div>
<div class="ttc" id="classUnimodalFunctionHeuristic_html_a2fa480addf2afe3a54cfd302f262bdb1"><div class="ttname"><a href="classUnimodalFunctionHeuristic.html#a2fa480addf2afe3a54cfd302f262bdb1">UnimodalFunctionHeuristic::tolerance</a></div><div class="ttdeci">double tolerance() const </div><div class="ttdef"><b>Definition:</b> <a href="HeuristicAlgorithms_8cpp_source.html#l00060">HeuristicAlgorithms.cpp:60</a></div></div>
<div class="ttc" id="classRoboticLineSolverLP_html_a03e4ded7195b4bef933e3bbafb2e56ee"><div class="ttname"><a href="classRoboticLineSolverLP.html#a03e4ded7195b4bef933e3bbafb2e56ee">RoboticLineSolverLP::addCollisionResolution</a></div><div class="ttdeci">void addCollisionResolution(Activity *i, Activity *j, const int32_t &amp;multipleOfCycleTime)</div><div class="ttdoc">It adds a constraint  to resolve a collision where  and  are start time and duration of the activity ...</div><div class="ttdef"><b>Definition:</b> <a href="RoboticLineSolverLP_8cpp_source.html#l00099">RoboticLineSolverLP.cpp:99</a></div></div>
<div class="ttc" id="classTabuList_html_ae181632961511ac1273b7b3a1ea9045e"><div class="ttname"><a href="classTabuList.html#ae181632961511ac1273b7b3a1ea9045e">TabuList::diversify</a></div><div class="ttdeci">void diversify()</div><div class="ttdef"><b>Definition:</b> <a href="DataStructures_8h_source.html#l00288">DataStructures.h:288</a></div></div>
<div class="ttc" id="classActivity_html"><div class="ttname"><a href="classActivity.html">Activity</a></div><div class="ttdoc">The base class incorporating common properties of robot operations and movements. ...</div><div class="ttdef"><b>Definition:</b> <a href="RoboticLine_8h_source.html#l00068">RoboticLine.h:68</a></div></div>
<div class="ttc" id="structSolution_html"><div class="ttname"><a href="structSolution.html">Solution</a></div><div class="ttdoc">The structure representing a solution found by an algorithm. </div><div class="ttdef"><b>Definition:</b> <a href="Solution_8h_source.html#l00050">Solution.h:50</a></div></div>
<div class="ttc" id="classHeuristicAlgorithms_html_a158982c033e99d89c93dba6c29f32e59"><div class="ttname"><a href="classHeuristicAlgorithms.html#a158982c033e99d89c93dba6c29f32e59">HeuristicAlgorithms::scaleGanttToCycleTime</a></div><div class="ttdeci">double scaleGanttToCycleTime(std::vector&lt; ActivityModeInfo &gt; &amp;robotGantt) const </div><div class="ttdoc">It scales durations of activities in such a way that the robot cycle time is met. Updated start times...</div><div class="ttdef"><b>Definition:</b> <a href="HeuristicAlgorithms_8cpp_source.html#l00505">HeuristicAlgorithms.cpp:505</a></div></div>
<div class="ttc" id="classHeuristicAlgorithms_html_a528054eec6e2326d4a36f81ff38ee3d1"><div class="ttname"><a href="classHeuristicAlgorithms.html#a528054eec6e2326d4a36f81ff38ee3d1">HeuristicAlgorithms::resolveTheWorstCollision</a></div><div class="ttdeci">CollisionResolution resolveTheWorstCollision(const PartialSolution &amp;ps, const OptimalTiming &amp;ot, const Solution &amp;s) const </div><div class="ttdoc">It finds the worst collision, i.e. with the longest time of active collision, and returns how to reso...</div><div class="ttdef"><b>Definition:</b> <a href="HeuristicAlgorithms_8cpp_source.html#l00282">HeuristicAlgorithms.cpp:282</a></div></div>
<div class="ttc" id="structOptimalTiming_html_a0723b96a68af48e083145b22f6102cf1"><div class="ttname"><a href="structOptimalTiming.html#a0723b96a68af48e083145b22f6102cf1">OptimalTiming::startMvs</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; double &gt; &gt; startMvs</div><div class="ttdoc">Start times assigned to dynamic activities&#39; movements. </div><div class="ttdef"><b>Definition:</b> <a href="DataStructures_8h_source.html#l00156">DataStructures.h:156</a></div></div>
<div class="ttc" id="structPartialSolution_html_a50fb6d7e10ac824afeeb56724d8c7468"><div class="ttname"><a href="structPartialSolution.html#a50fb6d7e10ac824afeeb56724d8c7468">PartialSolution::locs</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; Location * &gt; &gt; locs</div><div class="ttdoc">Selected locations for each robot, time ordered. </div><div class="ttdef"><b>Definition:</b> <a href="RoboticLineSolverLP_8h_source.html#l00045">RoboticLineSolverLP.h:45</a></div></div>
<div class="ttc" id="classHeuristicAlgorithms_html_aa36d3769a748d8c3ded630c515e0e8ad"><div class="ttname"><a href="classHeuristicAlgorithms.html#aa36d3769a748d8c3ded630c515e0e8ad">HeuristicAlgorithms::initializePartialSolution</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; Location * &gt; &gt; initializePartialSolution(PartialSolution &amp;ps) const </div><div class="ttdoc">It appends the fixed movements (implied from fixed locations), and optionally fastest power saving mo...</div><div class="ttdef"><b>Definition:</b> <a href="HeuristicAlgorithms_8cpp_source.html#l00107">HeuristicAlgorithms.cpp:107</a></div></div>
<div class="ttc" id="structPartialSolution_html_a011d753a484c4fa2e0bf803a49204ea6"><div class="ttname"><a href="structPartialSolution.html#a011d753a484c4fa2e0bf803a49204ea6">PartialSolution::pwrms</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; RobotPowerMode * &gt; &gt; pwrms</div><div class="ttdoc">Selected power saving modes of related locations. </div><div class="ttdef"><b>Definition:</b> <a href="RoboticLineSolverLP_8h_source.html#l00047">RoboticLineSolverLP.h:47</a></div></div>
<div class="ttc" id="structModeSwitchInfo_html_a314005046cd12abbcc219f0c96447fbe"><div class="ttname"><a href="structModeSwitchInfo.html#a314005046cd12abbcc219f0c96447fbe">ModeSwitchInfo::to</a></div><div class="ttdeci">RobotPowerMode * to</div><div class="ttdoc">The candidate power saving mode to switch to. </div><div class="ttdef"><b>Definition:</b> <a href="DataStructures_8h_source.html#l00210">DataStructures.h:210</a></div></div>
<div class="ttc" id="classUnimodalFunctionHeuristic_html_af0232f67ffe0a68c9a85feb900b8de52"><div class="ttname"><a href="classUnimodalFunctionHeuristic.html#af0232f67ffe0a68c9a85feb900b8de52">UnimodalFunctionHeuristic::mMv2</a></div><div class="ttdeci">Movement * mMv2</div><div class="ttdoc">The second movement to be considered. </div><div class="ttdef"><b>Definition:</b> <a href="HeuristicAlgorithms_8cpp_source.html#l00102">HeuristicAlgorithms.cpp:102</a></div></div>
<div class="ttc" id="classUnimodalFunctionHeuristic_html"><div class="ttname"><a href="classUnimodalFunctionHeuristic.html">UnimodalFunctionHeuristic</a></div><div class="ttdoc">An unimodal function for two movements and their fixed total time. </div><div class="ttdef"><b>Definition:</b> <a href="HeuristicAlgorithms_8cpp_source.html#l00036">HeuristicAlgorithms.cpp:36</a></div></div>
<div class="ttc" id="Solution_8h_html_a1eea77bd3ba8037d1d799c786438b53d"><div class="ttname"><a href="Solution_8h.html#a1eea77bd3ba8037d1d799c786438b53d">convert</a></div><div class="ttdeci">State convert(const Status &amp;ilpStatus)</div><div class="ttdoc">Conversion between the ILP solver status and the solution state. </div><div class="ttdef"><b>Definition:</b> <a href="Solution_8cpp_source.html#l00029">Solution.cpp:29</a></div></div>
<div class="ttc" id="namespacestd_html"><div class="ttname"><a href="namespacestd.html">std</a></div><div class="ttdoc">STL namespace. </div></div>
<div class="ttc" id="structCollisionResolution_html_a36aa751bee854b7c4867b3da5039599b"><div class="ttname"><a href="structCollisionResolution.html#a36aa751bee854b7c4867b3da5039599b">CollisionResolution::a2</a></div><div class="ttdeci">Activity * a2</div><div class="ttdoc">Second activity involved in the collision. </div><div class="ttdef"><b>Definition:</b> <a href="DataStructures_8h_source.html#l00178">DataStructures.h:178</a></div></div>
<div class="ttc" id="classSolutionChecker_html"><div class="ttname"><a href="classSolutionChecker.html">SolutionChecker</a></div><div class="ttdoc">An instance of this class is devoted to the solution checking. </div><div class="ttdef"><b>Definition:</b> <a href="SolutionChecker_8h_source.html#l00043">SolutionChecker.h:43</a></div></div>
<div class="ttc" id="structModeSwitchInfo_html_a592fec175c2a754eed72120d78fcfe53"><div class="ttname"><a href="structModeSwitchInfo.html#a592fec175c2a754eed72120d78fcfe53">ModeSwitchInfo::estimatedEnergy</a></div><div class="ttdeci">double estimatedEnergy</div><div class="ttdoc">Estimated energy consumption after switching to the candidate power saving mode. </div><div class="ttdef"><b>Definition:</b> <a href="DataStructures_8h_source.html#l00212">DataStructures.h:212</a></div></div>
<div class="ttc" id="classSolverException_html"><div class="ttname"><a href="classSolverException.html">SolverException</a></div><div class="ttdoc">A general exception of the program. </div><div class="ttdef"><b>Definition:</b> <a href="Exceptions_8h_source.html#l00058">Exceptions.h:58</a></div></div>
<div class="ttc" id="structCollisionResolution_html"><div class="ttname"><a href="structCollisionResolution.html">CollisionResolution</a></div><div class="ttdoc">The structure stores how to resolve one collision between robots. </div><div class="ttdef"><b>Definition:</b> <a href="DataStructures_8h_source.html#l00172">DataStructures.h:172</a></div></div>
<div class="ttc" id="classUnimodalFunctionHeuristic_html_a52a4add6f8ff2d18484e4249e179278b"><div class="ttname"><a href="classUnimodalFunctionHeuristic.html#a52a4add6f8ff2d18484e4249e179278b">UnimodalFunctionHeuristic::mTotalDuration</a></div><div class="ttdeci">double mTotalDuration</div><div class="ttdoc">The time needed for both the movements is equal to this fixed value. </div><div class="ttdef"><b>Definition:</b> <a href="HeuristicAlgorithms_8cpp_source.html#l00104">HeuristicAlgorithms.cpp:104</a></div></div>
<div class="ttc" id="classHeuristicAlgorithms_html_a533a4de85081bfc9bd1b545b5c228a71"><div class="ttname"><a href="classHeuristicAlgorithms.html#a533a4de85081bfc9bd1b545b5c228a71">HeuristicAlgorithms::heuristicPowerModeSelection</a></div><div class="ttdeci">double heuristicPowerModeSelection(const OptimalTiming &amp;ot, PartialSolution &amp;ps, TabuList &amp;tabuList, bool &amp;solutionChanged) const </div><div class="ttdoc">The sub-heuristic tries to switch from one power saving mode to another one for a location in order t...</div><div class="ttdef"><b>Definition:</b> <a href="HeuristicAlgorithms_8cpp_source.html#l00410">HeuristicAlgorithms.cpp:410</a></div></div>
<div class="ttc" id="classTabuList_html"><div class="ttname"><a href="classTabuList.html">TabuList</a></div><div class="ttdoc">A short-term memory, containing a list of forbidden moves, that mitigates the risk of cycling...</div><div class="ttdef"><b>Definition:</b> <a href="DataStructures_8h_source.html#l00254">DataStructures.h:254</a></div></div>
<div class="ttc" id="classUnimodalFunctionHeuristic_html_a94c1eaf7f8c66a5407469254eba7376a"><div class="ttname"><a href="classUnimodalFunctionHeuristic.html#a94c1eaf7f8c66a5407469254eba7376a">UnimodalFunctionHeuristic::functionValue</a></div><div class="ttdeci">double functionValue(const double &amp;alpha) const </div><div class="ttdoc">Returns a function value, i.e. total energy consumption of both movements. </div><div class="ttdef"><b>Definition:</b> <a href="HeuristicAlgorithms_8cpp_source.html#l00087">HeuristicAlgorithms.cpp:87</a></div></div>
<div class="ttc" id="classHeuristicAlgorithms_html_a3c7f241e3a995dec4df37f941776cdd1"><div class="ttname"><a href="classHeuristicAlgorithms.html#a3c7f241e3a995dec4df37f941776cdd1">HeuristicAlgorithms::resolveCollision</a></div><div class="ttdeci">CollisionResolution resolveCollision(ActivityMode *m1, double s1, double d1, ActivityMode *m2, double s2, double d2) const </div><div class="ttdoc">It checks whether there is a collision between two specified activities, and eventually returns how t...</div><div class="ttdef"><b>Definition:</b> <a href="HeuristicAlgorithms_8cpp_source.html#l00251">HeuristicAlgorithms.cpp:251</a></div></div>
<div class="ttc" id="classUnimodalFunctionHeuristic_html_a96d5698b4bf2ea174754568f1cd202a8"><div class="ttname"><a href="classUnimodalFunctionHeuristic.html#a96d5698b4bf2ea174754568f1cd202a8">UnimodalFunctionHeuristic::mDirection</a></div><div class="ttdeci">double mDirection</div><div class="ttdoc">A maximal possible difference in duration for both the movements. </div><div class="ttdef"><b>Definition:</b> <a href="HeuristicAlgorithms_8cpp_source.html#l00094">HeuristicAlgorithms.cpp:94</a></div></div>
<div class="ttc" id="HeuristicAlgorithms_8h_html"><div class="ttname"><a href="HeuristicAlgorithms_8h.html">HeuristicAlgorithms.h</a></div><div class="ttdoc">The optimization sub-heuristics and Linear Programming solver for partially fixed problems...</div></div>
<div class="ttc" id="structOptimalTiming_html_a8d8fa55e34745670850977414adbdd6c"><div class="ttname"><a href="structOptimalTiming.html#a8d8fa55e34745670850977414adbdd6c">OptimalTiming::startLocs</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; double &gt; &gt; startLocs</div><div class="ttdoc">Start times assigned to static activities&#39; locations. </div><div class="ttdef"><b>Definition:</b> <a href="DataStructures_8h_source.html#l00152">DataStructures.h:152</a></div></div>
<div class="ttc" id="structCollisionResolution_html_a2034dddc5d0801cf0b6376f2f0f8aa30"><div class="ttname"><a href="structCollisionResolution.html#a2034dddc5d0801cf0b6376f2f0f8aa30">CollisionResolution::multiplier</a></div><div class="ttdeci">int32_t multiplier</div><div class="ttdoc">Multiplier addressing the time shift in the number of cycles. </div><div class="ttdef"><b>Definition:</b> <a href="DataStructures_8h_source.html#l00180">DataStructures.h:180</a></div></div>
<div class="ttc" id="classSolutionChecker_html_a6a2add64cd9fb9c04e9c922df1079663"><div class="ttname"><a href="classSolutionChecker.html#a6a2add64cd9fb9c04e9c922df1079663">SolutionChecker::checkAll</a></div><div class="ttdeci">bool checkAll()</div><div class="ttdoc">It calls the private member methods to verify the solution. </div><div class="ttdef"><b>Definition:</b> <a href="SolutionChecker_8cpp_source.html#l00031">SolutionChecker.cpp:31</a></div></div>
<div class="ttc" id="NumericConstants_8h_html_aeff822503333aed003c2ce1c6673295b"><div class="ttname"><a href="NumericConstants_8h.html#aeff822503333aed003c2ce1c6673295b">TIME_ERR</a></div><div class="ttdeci">constexpr double TIME_ERR</div><div class="ttdoc">Minimal recognizable difference in the time. </div><div class="ttdef"><b>Definition:</b> <a href="NumericConstants_8h_source.html#l00035">NumericConstants.h:35</a></div></div>
<div class="ttc" id="NumericConstants_8h_html_a3ebebeda85a70b80e3aaa937ed8fb7a3"><div class="ttname"><a href="NumericConstants_8h.html#a3ebebeda85a70b80e3aaa937ed8fb7a3">TIME_TOL</a></div><div class="ttdeci">constexpr double TIME_TOL</div><div class="ttdoc">A minimal time difference that is considered significant for a solution. </div><div class="ttdef"><b>Definition:</b> <a href="NumericConstants_8h_source.html#l00031">NumericConstants.h:31</a></div></div>
<div class="ttc" id="structOptimalTiming_html_a2c697a59113a6120436a02dda26af22a"><div class="ttname"><a href="structOptimalTiming.html#a2c697a59113a6120436a02dda26af22a">OptimalTiming::totalEnergy</a></div><div class="ttdeci">double totalEnergy</div><div class="ttdoc">Energy consumption of a robotic cell for this timing. </div><div class="ttdef"><b>Definition:</b> <a href="DataStructures_8h_source.html#l00150">DataStructures.h:150</a></div></div>
<div class="ttc" id="structCircuitTuple_html"><div class="ttname"><a href="structCircuitTuple.html">CircuitTuple</a></div><div class="ttdoc">A partially fixed problem, i.e. tuple. </div><div class="ttdef"><b>Definition:</b> <a href="DataStructures_8h_source.html#l00133">DataStructures.h:133</a></div></div>
<div class="ttc" id="classInvalidArgument_html"><div class="ttname"><a href="classInvalidArgument.html">InvalidArgument</a></div><div class="ttdoc">Exception is thrown if a method is given invalid parameters or a user provides invalid program argume...</div><div class="ttdef"><b>Definition:</b> <a href="Exceptions_8h_source.html#l00120">Exceptions.h:120</a></div></div>
<div class="ttc" id="classNoFeasibleSolutionExists_html"><div class="ttname"><a href="classNoFeasibleSolutionExists.html">NoFeasibleSolutionExists</a></div><div class="ttdoc">Thrown if no feasible solution is found by the heuristic. </div><div class="ttdef"><b>Definition:</b> <a href="Exceptions_8h_source.html#l00134">Exceptions.h:134</a></div></div>
<div class="ttc" id="classStaticActivity_html"><div class="ttname"><a href="classStaticActivity.html">StaticActivity</a></div><div class="ttdoc">Collection of locations in which a robot operation (or waiting) can be performed. ...</div><div class="ttdef"><b>Definition:</b> <a href="RoboticLine_8h_source.html#l00304">RoboticLine.h:304</a></div></div>
<div class="ttc" id="structSolution_html_a21c7486cdfe34ac5f7769b3053f10a71"><div class="ttname"><a href="structSolution.html#a21c7486cdfe34ac5f7769b3053f10a71">Solution::status</a></div><div class="ttdeci">State status</div><div class="ttdoc">Enum specifying whether the solution is optimal, feasible, or infeasible... </div><div class="ttdef"><b>Definition:</b> <a href="Solution_8h_source.html#l00055">Solution.h:55</a></div></div>
<div class="ttc" id="structActivityModeInfo_html"><div class="ttname"><a href="structActivityModeInfo.html">ActivityModeInfo</a></div><div class="ttdoc">Structure encapsulates the time and energy properties of an activity with its selected mode (a moveme...</div><div class="ttdef"><b>Definition:</b> <a href="DataStructures_8h_source.html#l00219">DataStructures.h:219</a></div></div>
<div class="ttc" id="namespacestd_1_1chrono_html"><div class="ttname"><a href="namespacestd_1_1chrono.html">chrono</a></div></div>
<div class="ttc" id="structPartialSolution_html"><div class="ttname"><a href="structPartialSolution.html">PartialSolution</a></div><div class="ttdoc">Fixed locations, power saving modes, and movements. </div><div class="ttdef"><b>Definition:</b> <a href="RoboticLineSolverLP_8h_source.html#l00043">RoboticLineSolverLP.h:43</a></div></div>
<div class="ttc" id="classUnimodalFunctionHeuristic_html_abf424b8eae6b66ff39f868dd1fb576f3"><div class="ttname"><a href="classUnimodalFunctionHeuristic.html#abf424b8eae6b66ff39f868dd1fb576f3">UnimodalFunctionHeuristic::mMv1</a></div><div class="ttdeci">Movement * mMv1</div><div class="ttdoc">The first movement to be considered. </div><div class="ttdef"><b>Definition:</b> <a href="HeuristicAlgorithms_8cpp_source.html#l00100">HeuristicAlgorithms.cpp:100</a></div></div>
<div class="ttc" id="classRobotPowerMode_html"><div class="ttname"><a href="classRobotPowerMode.html">RobotPowerMode</a></div><div class="ttdoc">It represents the power saving mode of the robot. </div><div class="ttdef"><b>Definition:</b> <a href="RoboticLine_8h_source.html#l00359">RoboticLine.h:359</a></div></div>
<div class="ttc" id="classRoboticLineSolverLP_html"><div class="ttname"><a href="classRoboticLineSolverLP.html">RoboticLineSolverLP</a></div><div class="ttdoc">Determines an optimal timing of a partially fixed problem. </div><div class="ttdef"><b>Definition:</b> <a href="RoboticLineSolverLP_8h_source.html#l00058">RoboticLineSolverLP.h:58</a></div></div>
<div class="ttc" id="classUnimodalFunctionHeuristic_html_a14bfec242b90d2ff37a5b85fc0d07be8"><div class="ttname"><a href="classUnimodalFunctionHeuristic.html#a14bfec242b90d2ff37a5b85fc0d07be8">UnimodalFunctionHeuristic::durations</a></div><div class="ttdeci">pair&lt; double, double &gt; durations(const double &amp;alpha) const </div><div class="ttdoc">Calculates durations of the movements based on the relative step. </div><div class="ttdef"><b>Definition:</b> <a href="HeuristicAlgorithms_8cpp_source.html#l00071">HeuristicAlgorithms.cpp:71</a></div></div>
<div class="ttc" id="Algorithms_8h_html_a495ffa08b152c8a9b96ed636a9a46a2b"><div class="ttname"><a href="Algorithms_8h.html#a495ffa08b152c8a9b96ed636a9a46a2b">goldenSearch</a></div><div class="ttdeci">std::pair&lt; double, double &gt; goldenSearch(const T &amp;unimodalFce)</div><div class="ttdoc">It finds the minimal function value of a unimodal convex function. </div><div class="ttdef"><b>Definition:</b> <a href="Algorithms_8h_source.html#l00072">Algorithms.h:72</a></div></div>
<div class="ttc" id="classTimeLag_html"><div class="ttname"><a href="classTimeLag.html">TimeLag</a></div><div class="ttdoc">Instance of TimeLag class defines a time relation between two different robots. </div><div class="ttdef"><b>Definition:</b> <a href="RoboticLine_8h_source.html#l00481">RoboticLine.h:481</a></div></div>
<div class="ttc" id="Algorithms_8h_html"><div class="ttname"><a href="Algorithms_8h.html">Algorithms.h</a></div><div class="ttdoc">Universal algorithms like Floyd-Warshall, Golden Search, etc. </div></div>
<div class="ttc" id="classUnimodalFunctionHeuristic_html_a7371d3a7381ee883a488603d02beef9b"><div class="ttname"><a href="classUnimodalFunctionHeuristic.html#a7371d3a7381ee883a488603d02beef9b">UnimodalFunctionHeuristic::UnimodalFunctionHeuristic</a></div><div class="ttdeci">UnimodalFunctionHeuristic(Movement *mv1, Movement *mv2, double duration)</div><div class="ttdoc">Constructor initializes the member variables. </div><div class="ttdef"><b>Definition:</b> <a href="HeuristicAlgorithms_8cpp_source.html#l00043">HeuristicAlgorithms.cpp:43</a></div></div>
<div class="ttc" id="classHeuristicAlgorithms_html_a8ff0d590aa5f78e010fbfee385275e78"><div class="ttname"><a href="classHeuristicAlgorithms.html#a8ff0d590aa5f78e010fbfee385275e78">HeuristicAlgorithms::heuristicLocationChanges</a></div><div class="ttdeci">double heuristicLocationChanges(OptimalTiming &amp;ot, PartialSolution &amp;ps, const std::vector&lt; std::vector&lt; Location * &gt;&gt; &amp;fixed, bool &amp;solutionChanged) const </div><div class="ttdoc">The sub-heuristic locally optimizes the robot paths (change locations) to reduce energy consumption...</div><div class="ttdef"><b>Definition:</b> <a href="HeuristicAlgorithms_8cpp_source.html#l00305">HeuristicAlgorithms.cpp:305</a></div></div>
<div class="ttc" id="DataStructures_8h_html_a37b7af86392f48cd5663232e21b14b09"><div class="ttname"><a href="DataStructures_8h.html#a37b7af86392f48cd5663232e21b14b09">Algo</a></div><div class="ttdeci">Algo</div><div class="ttdoc">Defining constants for different states of the heuristic. </div><div class="ttdef"><b>Definition:</b> <a href="DataStructures_8h_source.html#l00036">DataStructures.h:36</a></div></div>
<div class="ttc" id="classRoboticLineSolverLP_html_aa2d9352113dd4da6a46ef216feb15796"><div class="ttname"><a href="classRoboticLineSolverLP.html#aa2d9352113dd4da6a46ef216feb15796">RoboticLineSolverLP::solve</a></div><div class="ttdeci">Solution solve() const </div><div class="ttdoc">The energy optimal timing is determined by solving Linear Programming problem and the solution is ret...</div><div class="ttdef"><b>Definition:</b> <a href="RoboticLineSolverLP_8cpp_source.html#l00049">RoboticLineSolverLP.cpp:49</a></div></div>
<div class="ttc" id="classMovement_html_a9009b6cf2a9e117e89d99e00c47540a2"><div class="ttname"><a href="classMovement.html#a9009b6cf2a9e117e89d99e00c47540a2">Movement::energyConsumption</a></div><div class="ttdeci">double energyConsumption(const double &amp;duration) const </div><div class="ttdef"><b>Definition:</b> <a href="RoboticLine_8cpp_source.html#l00031">RoboticLine.cpp:31</a></div></div>
<div class="ttc" id="classUnimodalFunctionHeuristic_html_ac0e1926785333ec3b798e70296a4964f"><div class="ttname"><a href="classUnimodalFunctionHeuristic.html#ac0e1926785333ec3b798e70296a4964f">UnimodalFunctionHeuristic::mToX</a></div><div class="ttdeci">double mToX</div><div class="ttdoc">The maximal duration of the first movement. </div><div class="ttdef"><b>Definition:</b> <a href="HeuristicAlgorithms_8cpp_source.html#l00098">HeuristicAlgorithms.cpp:98</a></div></div>
<div class="ttc" id="structCollisionResolution_html_a4e89d61d52db1501a516f6879276de3f"><div class="ttname"><a href="structCollisionResolution.html#a4e89d61d52db1501a516f6879276de3f">CollisionResolution::intersection</a></div><div class="ttdeci">double intersection</div><div class="ttdoc">Duration of the collision between activities a1 and a2. </div><div class="ttdef"><b>Definition:</b> <a href="DataStructures_8h_source.html#l00182">DataStructures.h:182</a></div></div>
<div class="ttc" id="structModeSwitchInfo_html_a8a031f3033c042750e589937da297d46"><div class="ttname"><a href="structModeSwitchInfo.html#a8a031f3033c042750e589937da297d46">ModeSwitchInfo::locationIdx</a></div><div class="ttdeci">uint32_t locationIdx</div><div class="ttdoc">Index of the related location of the robot. </div><div class="ttdef"><b>Definition:</b> <a href="DataStructures_8h_source.html#l00204">DataStructures.h:204</a></div></div>
<div class="ttc" id="classHeuristicAlgorithms_html_a06c6dc074edf564b38dd85ea99148180"><div class="ttname"><a href="classHeuristicAlgorithms.html#a06c6dc074edf564b38dd85ea99148180">HeuristicAlgorithms::convert</a></div><div class="ttdeci">OptimalTiming convert(const PartialSolution &amp;ps, const Solution &amp;s) const </div><div class="ttdoc">Auxiliary method that converts a general form of the solution to the timing of the robotic cell...</div><div class="ttdef"><b>Definition:</b> <a href="HeuristicAlgorithms_8cpp_source.html#l00199">HeuristicAlgorithms.cpp:199</a></div></div>
<div class="ttc" id="structPartialSolution_html_a4bc15548f2b4e6ae425952245ba3cca8"><div class="ttname"><a href="structPartialSolution.html#a4bc15548f2b4e6ae425952245ba3cca8">PartialSolution::mvs</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; Movement * &gt; &gt; mvs</div><div class="ttdoc">Selected movements, implied from the selected locations and their order. </div><div class="ttdef"><b>Definition:</b> <a href="RoboticLineSolverLP_8h_source.html#l00049">RoboticLineSolverLP.h:49</a></div></div>
<div class="ttc" id="structModeSwitchInfo_html_abb3dcb121fafaf7ce0cd2fba6207da99"><div class="ttname"><a href="structModeSwitchInfo.html#abb3dcb121fafaf7ce0cd2fba6207da99">ModeSwitchInfo::from</a></div><div class="ttdeci">RobotPowerMode * from</div><div class="ttdoc">The original power saving mode. </div><div class="ttdef"><b>Definition:</b> <a href="DataStructures_8h_source.html#l00208">DataStructures.h:208</a></div></div>
<div class="ttc" id="classActivityMode_html"><div class="ttname"><a href="classActivityMode.html">ActivityMode</a></div><div class="ttdoc">Either a movement or location. </div><div class="ttdef"><b>Definition:</b> <a href="RoboticLine_8h_source.html#l00054">RoboticLine.h:54</a></div></div>
<div class="ttc" id="SolutionChecker_8h_html"><div class="ttname"><a href="SolutionChecker_8h.html">SolutionChecker.h</a></div><div class="ttdoc">The file declares a class responsible for checking of solutions. </div></div>
<div class="ttc" id="structModeSwitchInfo_html"><div class="ttname"><a href="structModeSwitchInfo.html">ModeSwitchInfo</a></div><div class="ttdoc">Records a potential energy impact if a power saving mode of a robot is switched to another one...</div><div class="ttdef"><b>Definition:</b> <a href="DataStructures_8h_source.html#l00191">DataStructures.h:191</a></div></div>
<div class="ttc" id="classLocation_html"><div class="ttname"><a href="classLocation.html">Location</a></div><div class="ttdoc">Location of the robot used either during work (welding) or waiting. </div><div class="ttdef"><b>Definition:</b> <a href="RoboticLine_8h_source.html#l00192">RoboticLine.h:192</a></div></div>
<div class="ttc" id="structOptimalTiming_html_a56957ffcae1b9fbe374243eae121834b"><div class="ttname"><a href="structOptimalTiming.html#a56957ffcae1b9fbe374243eae121834b">OptimalTiming::actToStartAndDur</a></div><div class="ttdeci">std::map&lt; Activity *, std::pair&lt; double, double &gt; &gt; actToStartAndDur</div><div class="ttdoc">Activity to the assigned start time and duration. </div><div class="ttdef"><b>Definition:</b> <a href="DataStructures_8h_source.html#l00161">DataStructures.h:161</a></div></div>
<div class="ttc" id="structModeSwitchInfo_html_a42f3f53b357394ff53f7fd9b1cc0b85b"><div class="ttname"><a href="structModeSwitchInfo.html#a42f3f53b357394ff53f7fd9b1cc0b85b">ModeSwitchInfo::loc</a></div><div class="ttdeci">Location * loc</div><div class="ttdoc">A pointer to the considered location. </div><div class="ttdef"><b>Definition:</b> <a href="DataStructures_8h_source.html#l00206">DataStructures.h:206</a></div></div>
<div class="ttc" id="classLocation_html_a220e8f7528572f0035823461e10b7fba"><div class="ttname"><a href="classLocation.html#a220e8f7528572f0035823461e10b7fba">Location::energyConsumption</a></div><div class="ttdeci">double energyConsumption(const double &amp;duration, RobotPowerMode *m) const </div><div class="ttdef"><b>Definition:</b> <a href="RoboticLine_8cpp_source.html#l00056">RoboticLine.cpp:56</a></div></div>
<div class="ttc" id="structOptimalTiming_html_a7484e949e2071d1e150aaade60768365"><div class="ttname"><a href="structOptimalTiming.html#a7484e949e2071d1e150aaade60768365">OptimalTiming::modeToStartAndDur</a></div><div class="ttdeci">std::map&lt; ActivityMode *, std::pair&lt; double, double &gt; &gt; modeToStartAndDur</div><div class="ttdoc">Selected location/movement to the assigned start time and duration. </div><div class="ttdef"><b>Definition:</b> <a href="DataStructures_8h_source.html#l00163">DataStructures.h:163</a></div></div>
<div class="ttc" id="structOptimalTiming_html_a826c23e5865dcc4291085d06cfc9bd34"><div class="ttname"><a href="structOptimalTiming.html#a826c23e5865dcc4291085d06cfc9bd34">OptimalTiming::durMvs</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; double &gt; &gt; durMvs</div><div class="ttdoc">Durations assigned to dynamic activities&#39; movements. </div><div class="ttdef"><b>Definition:</b> <a href="DataStructures_8h_source.html#l00158">DataStructures.h:158</a></div></div>
<div class="ttc" id="classHeuristicAlgorithms_html_abd5588eab6e5aaf559d00d8421a51009"><div class="ttname"><a href="classHeuristicAlgorithms.html#abd5588eab6e5aaf559d00d8421a51009">HeuristicAlgorithms::solvePartialProblem</a></div><div class="ttdeci">OptimalTiming solvePartialProblem(const PartialSolution &amp;ps, const CircuitTuple &amp;t, Algo algo)</div><div class="ttdoc">Employs Linear Programming to obtain energy-efficient timing for a given tuple. </div><div class="ttdef"><b>Definition:</b> <a href="HeuristicAlgorithms_8cpp_source.html#l00138">HeuristicAlgorithms.cpp:138</a></div></div>
<div class="ttc" id="structOptimalTiming_html"><div class="ttname"><a href="structOptimalTiming.html">OptimalTiming</a></div><div class="ttdoc">Obtained timing for a partial problem. </div><div class="ttdef"><b>Definition:</b> <a href="DataStructures_8h_source.html#l00148">DataStructures.h:148</a></div></div>
<div class="ttc" id="structModeSwitchInfo_html_af4146cc2a0f29f63abef99ae641f9cf9"><div class="ttname"><a href="structModeSwitchInfo.html#af4146cc2a0f29f63abef99ae641f9cf9">ModeSwitchInfo::robotIdx</a></div><div class="ttdeci">uint32_t robotIdx</div><div class="ttdoc">Index of the robot. </div><div class="ttdef"><b>Definition:</b> <a href="DataStructures_8h_source.html#l00202">DataStructures.h:202</a></div></div>
<div class="ttc" id="classHeuristicAlgorithms_html_ae601403b9ed04c839f484013ca95efa0"><div class="ttname"><a href="classHeuristicAlgorithms.html#ae601403b9ed04c839f484013ca95efa0">HeuristicAlgorithms::calculateBreakagePenalty</a></div><div class="ttdeci">double calculateBreakagePenalty(const std::vector&lt; ActivityModeInfo &gt; &amp;robotGantt, const OptimalTiming &amp;ot) const </div><div class="ttdoc">It calculates the penalty for the violation of time lags and collisions. </div><div class="ttdef"><b>Definition:</b> <a href="HeuristicAlgorithms_8cpp_source.html#l00599">HeuristicAlgorithms.cpp:599</a></div></div>
<div class="ttc" id="structSolution_html_af866c54d9f8d981893e55b572aed0375"><div class="ttname"><a href="structSolution.html#af866c54d9f8d981893e55b572aed0375">Solution::startTimeAndDuration</a></div><div class="ttdeci">std::map&lt; uint32_t, std::pair&lt; double, double &gt; &gt; startTimeAndDuration</div><div class="ttdoc">Mapping of the activity identification to its start time and duration. </div><div class="ttdef"><b>Definition:</b> <a href="Solution_8h_source.html#l00065">Solution.h:65</a></div></div>
<div class="ttc" id="structCollisionResolution_html_a839f4a62c78c4722f7e9e89ddadffa15"><div class="ttname"><a href="structCollisionResolution.html#a839f4a62c78c4722f7e9e89ddadffa15">CollisionResolution::a1</a></div><div class="ttdeci">Activity * a1</div><div class="ttdoc">First activity involved in the collision. </div><div class="ttdef"><b>Definition:</b> <a href="DataStructures_8h_source.html#l00176">DataStructures.h:176</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Oct 7 2015 17:52:27 for solver by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
